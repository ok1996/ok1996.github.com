(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{346:function(a,s,e){a.exports=e.p+"assets/img/note-9455.fc79c03f.png"},347:function(a,s,e){a.exports=e.p+"assets/img/note-4093.2560193c.png"},348:function(a,s,e){a.exports=e.p+"assets/img/note-53388.d33d148b.png"},349:function(a,s,e){a.exports=e.p+"assets/img/note-31824.036b75ca.png"},350:function(a,s,e){a.exports=e.p+"assets/img/note-67784.053375a0.png"},351:function(a,s,e){a.exports=e.p+"assets/img/note-87251.cd4ce102.png"},352:function(a,s,e){a.exports=e.p+"assets/img/note-83190.ab10e7b5.png"},353:function(a,s,e){a.exports=e.p+"assets/img/note-95733.b3617902.png"},354:function(a,s,e){a.exports=e.p+"assets/img/note-65433.cbaf7be8.png"},355:function(a,s,e){a.exports=e.p+"assets/img/note-98726.73b17ebd.png"},638:function(a,s,e){"use strict";e.r(s);var n=e(7),r=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"工程接入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#工程接入"}},[a._v("#")]),a._v(" 工程接入")]),a._v(" "),s("p",[a._v("kafka批量消费")]),a._v(" "),s("h3",{attrs:{id:"pom文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pom文件"}},[a._v("#")]),a._v(" pom文件")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("        <dependency>\n            <groupId>org.springframework.kafka</groupId>\n            <artifactId>spring-kafka</artifactId>\n        </dependency>\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"yml文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yml文件"}},[a._v("#")]),a._v(" yml文件")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("server:\n  servlet:\n    context-path: /imdemosc\n  port: 8610\nspring: \n  application:\n    name: imdemosc\n  kafka:\n    bootstrap-servers: 192.168.213.215:9092,192.168.213.215:9091,192.168.213.215:9093\n    consumer:\n      enable-auto-commit: true\n      group-id: dsaim105\n      # 批量一次最大拉取数据量\n      max-poll-records: 100\n      auto-commit-interval: 100\n      auto-offset-reset: latest\n      bootstrap-servers: 192.168.213.215:9092,192.168.213.215:9091,192.168.213.215:9093\n    producer:\n      # 重试次数\n      retries: 3\n      # 批量发送的消息数量\n      batch-size: 100\n      # 32MB的批处理缓冲区\n      buffer-memory: 33554432\n      bootstrap-servers: 192.168.213.215:9092,192.168.213.215:9091,192.168.213.215:9093\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br")])]),s("h3",{attrs:{id:"java文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java文件"}},[a._v("#")]),a._v(" JAVA文件")]),a._v(" "),s("h4",{attrs:{id:"kafka消费者配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kafka消费者配置文件"}},[a._v("#")]),a._v(" kafka消费者配置文件")]),a._v(" "),s("p",[a._v("KafkaConsumerConfig")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('package ok96.cn;\n\nimport org.apache.kafka.clients.consumer.ConsumerConfig;\nimport org.apache.kafka.clients.producer.ProducerConfig;\nimport org.apache.kafka.common.serialization.StringDeserializer;\nimport org.apache.kafka.common.serialization.StringSerializer;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.kafka.annotation.EnableKafka;\nimport org.springframework.kafka.config.ConcurrentKafkaListenerContainerFactory;\nimport org.springframework.kafka.config.KafkaListenerContainerFactory;\nimport org.springframework.kafka.core.DefaultKafkaConsumerFactory;\nimport org.springframework.kafka.core.DefaultKafkaProducerFactory;\nimport org.springframework.kafka.core.KafkaTemplate;\nimport org.springframework.kafka.core.ProducerFactory;\nimport org.springframework.kafka.listener.ConcurrentMessageListenerContainer;\n\nimport java.util.HashMap;\nimport java.util.Map;\n@Configuration\n@EnableKafka\npublic class KafkaConsumerConfig {\n    @Value("${spring.kafka.consumer.bootstrap-servers}")\n    private String consumerBootstrapServers;\n\n    @Value("${spring.kafka.producer.bootstrap-servers}")\n    private String producerBootstrapServers;\n\n    @Value("${spring.kafka.consumer.enable-auto-commit}")\n    private Boolean autoCommit;\n\n    @Value("${spring.kafka.consumer.auto-commit-interval}")\n    private Integer autoCommitInterval;\n\n    @Value("${spring.kafka.consumer.group-id}")\n    private String groupId;\n\n    @Value("${spring.kafka.consumer.max-poll-records}")\n    private Integer maxPollRecords;\n\n    @Value("${spring.kafka.consumer.auto-offset-reset}")\n    private String autoOffsetReset;\n\n    @Value("${spring.kafka.producer.retries}")\n    private Integer retries;\n\n    @Value("${spring.kafka.producer.batch-size}")\n    private Integer batchSize;\n\n    @Value("${spring.kafka.producer.buffer-memory}")\n    private Integer bufferMemory;\n\n    /**\n     *  生产者配置信息\n     */\n    @Bean\n    public Map<String, Object> producerConfigs() {\n        Map<String, Object> props = new HashMap<String, Object>();\n        props.put(ProducerConfig.ACKS_CONFIG, "0");\n        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, producerBootstrapServers);\n        props.put(ProducerConfig.RETRIES_CONFIG, retries);\n        props.put(ProducerConfig.BATCH_SIZE_CONFIG, batchSize);\n        props.put(ProducerConfig.LINGER_MS_CONFIG, 1);\n        props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, bufferMemory);\n        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n        return props;\n    }\n\n    /**\n     *  生产者工厂\n     */\n    @Bean\n    public ProducerFactory<String, String> producerFactory() {\n        return new DefaultKafkaProducerFactory<>(producerConfigs());\n    }\n\n    /**\n     *  生产者模板\n     */\n    @Bean\n    public KafkaTemplate<String, String> kafkaTemplate() {\n        return new KafkaTemplate<>(producerFactory());\n    }\n\n    /**\n     *  消费者配置信息\n     */\n    @Bean\n    public Map<String, Object> consumerConfigs() {\n        Map<String, Object> props = new HashMap<String, Object>();\n        props.put(ConsumerConfig.GROUP_ID_CONFIG, groupId);\n        props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, autoOffsetReset);\n        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, consumerBootstrapServers);\n        props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, maxPollRecords);\n        props.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, 120000);\n        props.put(ConsumerConfig.REQUEST_TIMEOUT_MS_CONFIG, 180000);\n        props.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, 500);\n        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n        return props;\n    }\n\n    /**\n     *  消费者批量工程\n     */\n    @Bean\n    KafkaListenerContainerFactory<ConcurrentMessageListenerContainer<String, String>> batchFactory() {\n        ConcurrentKafkaListenerContainerFactory<String, String> factory = new ConcurrentKafkaListenerContainerFactory<>();\n        factory.setConsumerFactory(new DefaultKafkaConsumerFactory<>(consumerConfigs()));\n        factory.setConcurrency(1);\n        //设置为批量消费，每个批次数量在Kafka配置参数中设置ConsumerConfig.MAX_POLL_RECORDS_CONFIG\n        factory.setBatchListener(true);\n        factory.getContainerProperties().setPollTimeout(1000);\n        \n        return factory;\n    }\n\n//    @Bean\n//    public KafkaConsumerListener listener(){\n//        return new KafkaConsumerListener();\n//    }\n}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br"),s("span",{staticClass:"line-number"},[a._v("43")]),s("br"),s("span",{staticClass:"line-number"},[a._v("44")]),s("br"),s("span",{staticClass:"line-number"},[a._v("45")]),s("br"),s("span",{staticClass:"line-number"},[a._v("46")]),s("br"),s("span",{staticClass:"line-number"},[a._v("47")]),s("br"),s("span",{staticClass:"line-number"},[a._v("48")]),s("br"),s("span",{staticClass:"line-number"},[a._v("49")]),s("br"),s("span",{staticClass:"line-number"},[a._v("50")]),s("br"),s("span",{staticClass:"line-number"},[a._v("51")]),s("br"),s("span",{staticClass:"line-number"},[a._v("52")]),s("br"),s("span",{staticClass:"line-number"},[a._v("53")]),s("br"),s("span",{staticClass:"line-number"},[a._v("54")]),s("br"),s("span",{staticClass:"line-number"},[a._v("55")]),s("br"),s("span",{staticClass:"line-number"},[a._v("56")]),s("br"),s("span",{staticClass:"line-number"},[a._v("57")]),s("br"),s("span",{staticClass:"line-number"},[a._v("58")]),s("br"),s("span",{staticClass:"line-number"},[a._v("59")]),s("br"),s("span",{staticClass:"line-number"},[a._v("60")]),s("br"),s("span",{staticClass:"line-number"},[a._v("61")]),s("br"),s("span",{staticClass:"line-number"},[a._v("62")]),s("br"),s("span",{staticClass:"line-number"},[a._v("63")]),s("br"),s("span",{staticClass:"line-number"},[a._v("64")]),s("br"),s("span",{staticClass:"line-number"},[a._v("65")]),s("br"),s("span",{staticClass:"line-number"},[a._v("66")]),s("br"),s("span",{staticClass:"line-number"},[a._v("67")]),s("br"),s("span",{staticClass:"line-number"},[a._v("68")]),s("br"),s("span",{staticClass:"line-number"},[a._v("69")]),s("br"),s("span",{staticClass:"line-number"},[a._v("70")]),s("br"),s("span",{staticClass:"line-number"},[a._v("71")]),s("br"),s("span",{staticClass:"line-number"},[a._v("72")]),s("br"),s("span",{staticClass:"line-number"},[a._v("73")]),s("br"),s("span",{staticClass:"line-number"},[a._v("74")]),s("br"),s("span",{staticClass:"line-number"},[a._v("75")]),s("br"),s("span",{staticClass:"line-number"},[a._v("76")]),s("br"),s("span",{staticClass:"line-number"},[a._v("77")]),s("br"),s("span",{staticClass:"line-number"},[a._v("78")]),s("br"),s("span",{staticClass:"line-number"},[a._v("79")]),s("br"),s("span",{staticClass:"line-number"},[a._v("80")]),s("br"),s("span",{staticClass:"line-number"},[a._v("81")]),s("br"),s("span",{staticClass:"line-number"},[a._v("82")]),s("br"),s("span",{staticClass:"line-number"},[a._v("83")]),s("br"),s("span",{staticClass:"line-number"},[a._v("84")]),s("br"),s("span",{staticClass:"line-number"},[a._v("85")]),s("br"),s("span",{staticClass:"line-number"},[a._v("86")]),s("br"),s("span",{staticClass:"line-number"},[a._v("87")]),s("br"),s("span",{staticClass:"line-number"},[a._v("88")]),s("br"),s("span",{staticClass:"line-number"},[a._v("89")]),s("br"),s("span",{staticClass:"line-number"},[a._v("90")]),s("br"),s("span",{staticClass:"line-number"},[a._v("91")]),s("br"),s("span",{staticClass:"line-number"},[a._v("92")]),s("br"),s("span",{staticClass:"line-number"},[a._v("93")]),s("br"),s("span",{staticClass:"line-number"},[a._v("94")]),s("br"),s("span",{staticClass:"line-number"},[a._v("95")]),s("br"),s("span",{staticClass:"line-number"},[a._v("96")]),s("br"),s("span",{staticClass:"line-number"},[a._v("97")]),s("br"),s("span",{staticClass:"line-number"},[a._v("98")]),s("br"),s("span",{staticClass:"line-number"},[a._v("99")]),s("br"),s("span",{staticClass:"line-number"},[a._v("100")]),s("br"),s("span",{staticClass:"line-number"},[a._v("101")]),s("br"),s("span",{staticClass:"line-number"},[a._v("102")]),s("br"),s("span",{staticClass:"line-number"},[a._v("103")]),s("br"),s("span",{staticClass:"line-number"},[a._v("104")]),s("br"),s("span",{staticClass:"line-number"},[a._v("105")]),s("br"),s("span",{staticClass:"line-number"},[a._v("106")]),s("br"),s("span",{staticClass:"line-number"},[a._v("107")]),s("br"),s("span",{staticClass:"line-number"},[a._v("108")]),s("br"),s("span",{staticClass:"line-number"},[a._v("109")]),s("br"),s("span",{staticClass:"line-number"},[a._v("110")]),s("br"),s("span",{staticClass:"line-number"},[a._v("111")]),s("br"),s("span",{staticClass:"line-number"},[a._v("112")]),s("br"),s("span",{staticClass:"line-number"},[a._v("113")]),s("br"),s("span",{staticClass:"line-number"},[a._v("114")]),s("br"),s("span",{staticClass:"line-number"},[a._v("115")]),s("br"),s("span",{staticClass:"line-number"},[a._v("116")]),s("br"),s("span",{staticClass:"line-number"},[a._v("117")]),s("br"),s("span",{staticClass:"line-number"},[a._v("118")]),s("br"),s("span",{staticClass:"line-number"},[a._v("119")]),s("br"),s("span",{staticClass:"line-number"},[a._v("120")]),s("br"),s("span",{staticClass:"line-number"},[a._v("121")]),s("br"),s("span",{staticClass:"line-number"},[a._v("122")]),s("br"),s("span",{staticClass:"line-number"},[a._v("123")]),s("br"),s("span",{staticClass:"line-number"},[a._v("124")]),s("br")])]),s("h4",{attrs:{id:"kafka监听消费入口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kafka监听消费入口"}},[a._v("#")]),a._v(" kafka监听消费入口")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('package ok96.cn;\n\nimport static java.util.concurrent.Executors.newCachedThreadPool;\n\nimport java.util.List;\nimport java.util.concurrent.ExecutorService;\n\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\nimport org.springframework.kafka.annotation.KafkaListener;\nimport org.springframework.stereotype.Component;\n\n\n\n\n@Component\npublic class KafkaBatchListener {\n\n    @KafkaListener(topics = "imtest6", containerFactory = "batchFactory")\n    public void listenPartition1(List<ConsumerRecord<?, ?>> records) {\n        System.out.println("我进来啦");\n    }\n\n}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br")])]),s("h2",{attrs:{id:"集成kafka权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集成kafka权限"}},[a._v("#")]),a._v(" 集成KAFKA权限")]),a._v(" "),s("p",[a._v("SASL_PLAINTEXT")]),a._v(" "),s("h3",{attrs:{id:"在kafka消费者配置文件增加配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在kafka消费者配置文件增加配置"}},[a._v("#")]),a._v(" 在kafka消费者配置文件增加配置")]),a._v(" "),s("p",[a._v("在producerConfigs方法和consumerConfigs方法中增加")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('props.put("security.protocol","SASL_PLAINTEXT");\nprops.put("sasl.mechanism","PLAIN");\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"在resources下增加文件kafka-client-jaas-conf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在resources下增加文件kafka-client-jaas-conf"}},[a._v("#")]),a._v(" 在resources下增加文件kafka_client_jaas.conf")]),a._v(" "),s("p",[a._v("文件内容username和password为kafka中设置的权限账号密码")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('KafkaClient {\n  org.apache.kafka.common.security.plain.PlainLoginModule required\n  username="ok96"\n  password="ok96-password";\n};\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h3",{attrs:{id:"启动类增加setproperty"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动类增加setproperty"}},[a._v("#")]),a._v(" 启动类增加setProperty")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('@SpringBootApplication\npublic class SpringbootApp {\n    public static void main(String[] args) {\n        String dirname = "classpath:kafka_client_jaas.conf";\n        System.setProperty("java.security.auth.login.config", dirname);\n        SpringApplication.run(SpringbootApp.class, args);\n    }\n}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h2",{attrs:{id:"常用代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用代码"}},[a._v("#")]),a._v(" 常用代码")]),a._v(" "),s("h3",{attrs:{id:"发送实体类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发送实体类"}},[a._v("#")]),a._v(" 发送实体类")]),a._v(" "),s("p",[a._v("也就是先将XXXX实体类转换成String")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ObjectMapper mapper2 = new ObjectMapper();\nkafkaTemplate.send(topic, mapper2.writeValueAsString(XXXXX));\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"消费实体类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#消费实体类"}},[a._v("#")]),a._v(" 消费实体类")]),a._v(" "),s("p",[a._v("也就是将String转换成XXXX实体类,可以在getTypeReference方法修改为静态方法，增加static"),s("br"),a._v("\n修改KafkaBatchListener")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('package cn.ok96;\n\nimport java.util.List;\nimport java.util.concurrent.ExecutorService;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\nimport org.springframework.kafka.annotation.KafkaListener;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class KafkaBatchListener {\n\n    public TypeReference<?> getTypeReferenceTemp() {\n        return new TypeReference<XXXX>() {\n        };\n    }\n    \n    @KafkaListener(topics = "imtest6", containerFactory = "batchFactory")\n    public void listenPartition1(List<ConsumerRecord<String,String>> records) {\n        for (ConsumerRecord<String, String> record : records) {\n            Optional<String> kafkaMessage = Optional.ofNullable(record.value());\n            if (kafkaMessage.isPresent()) {\n                //消息接收正常\n                ObjectMapper mapper2 = new ObjectMapper();\n                XXXX xxxx = (XXXX) mapper2.readValue(record.value(), getTypeReferenceTemp());\n            }\n        }\n        \n    }\n\n}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br")])]),s("h3",{attrs:{id:"监听topic使用配置文件常量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#监听topic使用配置文件常量"}},[a._v("#")]),a._v(" 监听topic使用配置文件常量")]),a._v(" "),s("h4",{attrs:{id:"yml配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yml配置文件"}},[a._v("#")]),a._v(" yml配置文件")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("kafkaSelf:\n  topic: test\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h4",{attrs:{id:"java代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java代码"}},[a._v("#")]),a._v(" JAVA代码")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('@KafkaListener(topics = "#{\'${kafkaSelf.topic}\'}", containerFactory = "batchFactory")\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"部署kafka"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署kafka"}},[a._v("#")]),a._v(" 部署KAFKA")]),a._v(" "),s("p",[a._v("服务器IP：192.168.213.200")]),a._v(" "),s("h3",{attrs:{id:"docker-单机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-单机"}},[a._v("#")]),a._v(" Docker-单机")]),a._v(" "),s("p",[a._v("docker-compose.yml，连接地址192.168.213.200:19092")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("version: '3'\nservices:\n  kafka-zookeeper:\n    image: openzipkin/zipkin-kafka:2.11.12\n    restart: always\n    container_name: kafka-zookeeper\n    ports:\n      - 2181:2181\n      - 9092:9092\n      - 19092:19092\n    environment:\n      - KAFKA_ADVERTISED_HOST_NAME=192.168.213.200\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("p",[a._v("命令行")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker run -d --restart=always --name kafka-zookeeper -p 2181:2181 -p 9092:9092 -p 19092:19092  --env KAFKA_ADVERTISED_HOST_NAME=192.168.213.200  openzipkin/zipkin-kafka:2.11.12\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("部署成功测试")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("1.开启两个终端进入kafka\ndocker exec -it kafka-zookeeper /bin/sh\n2.分别在终端容器内部执行\n终端1\nunset JMX_PORT;bin/kafka-console-producer.sh --broker-list 192.168.213.200:19092 --topic test9999\n终端2\nunset JMX_PORT;bin/kafka-console-consumer.sh --bootstrap-server 192.168.213.200:19092 --topic test9999 --from-beginning\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h3",{attrs:{id:"宿主机-单机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#宿主机-单机"}},[a._v("#")]),a._v(" 宿主机-单机")]),a._v(" "),s("p",[a._v("服务器ip：192.168.213.203"),s("br"),a._v("\n连接地址：192.168.213.203:9092")]),a._v(" "),s("h4",{attrs:{id:"上传压缩包并解压"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#上传压缩包并解压"}},[a._v("#")]),a._v(" 上传压缩包并解压")]),a._v(" "),s("p",[a._v("上传kafka_2.12-2.3.0.tgz到/data/目录下"),s("br"),a._v("\n解压")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("tar -zvxf kafka_2.12-2.3.0.tgz\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"修改配置并启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改配置并启动"}},[a._v("#")]),a._v(" 修改配置并启动")]),a._v(" "),s("p",[a._v("修改server.properties")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vi /data/kafka_2.12-2.3.0/config/server.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("增加以下内容，保存并退出")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("listeners=PLAINTEXT://192.168.213.203:9092\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:e(346),alt:"note"}})]),a._v(" "),s("p",[a._v("启动")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cd /data/kafka_2.12-2.3.0\nbin/zookeeper-server-start.sh -daemon config/zookeeper.properties\nbin/kafka-server-start.sh -daemon  config/server.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("查看日志")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("tail -f /data/kafka_2.12-2.3.0/logs/zookeeper.out\ntail -f /data/kafka_2.12-2.3.0/logs/kafkaServer.out\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h4",{attrs:{id:"创建topic"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建topic"}},[a._v("#")]),a._v(" 创建topic")]),a._v(" "),s("p",[a._v("创建topic：tpc.test001")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("/data/kafka_2.12-2.3.0/bin/kafka-topics.sh --create --zookeeper 192.168.213.203:2181 --replication-factor 1 --partitions 1 --topic tpc.test001\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"配置sasl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置sasl"}},[a._v("#")]),a._v(" 配置SASL")]),a._v(" "),s("h4",{attrs:{id:"服务端配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务端配置"}},[a._v("#")]),a._v(" 服务端配置")]),a._v(" "),s("h5",{attrs:{id:"修改server-properties"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改server-properties"}},[a._v("#")]),a._v(" 修改server.properties")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vi /data/kafka_2.12-2.3.0/config/server.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("修改/增加以下内容,将原来写的listeners用#注释")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("listeners=SASL_PLAINTEXT://192.168.213.203:9092\nsecurity.inter.broker.protocol=SASL_PLAINTEXT\nsasl.mechanism.inter.broker.protocol=PLAIN\nsasl.enabled.mechanisms=PLAIN\nauthorizer.class.name=kafka.security.auth.SimpleAclAuthorizer\nallow.everyone.if.no.acl.found=true\nsuper.users=User:admin\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[s("img",{attrs:{src:e(347),alt:"note"}})]),a._v(" "),s("h5",{attrs:{id:"创建账号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建账号"}},[a._v("#")]),a._v(" 创建账号")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vi /data/kafka_2.12-2.3.0/config/kafka_server_jaas.conf\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("增加以下内容,保存并退出")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('KafkaServer {\norg.apache.kafka.common.security.plain.PlainLoginModule required\nusername="admin"\npassword="admin-pwd"\nuser_admin="admin-pwd"\nuser_wuxiaoku="xiaoku-lzx22247a";\n};\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("管理员账号：admin 密码 admin-pwd")]),a._v(" "),s("p",[a._v("普通用户账号：wuxiaoku 密码 xiaoku-lzx22247a\n"),s("img",{attrs:{src:e(348),alt:"note"}})]),a._v(" "),s("h5",{attrs:{id:"修改kafka-run-class-sh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改kafka-run-class-sh"}},[a._v("#")]),a._v(" 修改kafka-run-class.sh")]),a._v(" "),s("p",[a._v("添加java.security.auth.login.config环境变量")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vi /data/kafka_2.12-2.3.0/bin/kafka-run-class.sh\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("增加")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("KAFKA_SASL_OPTS='-Djava.security.auth.login.config=/data/kafka_2.12-2.3.0/config/kafka_server_jaas.conf'\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("增加")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("$KAFKA_SASL_OPTS\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:e(349),alt:"note"}})]),a._v(" "),s("h4",{attrs:{id:"客户端配置账号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端配置账号"}},[a._v("#")]),a._v(" 客户端配置账号")]),a._v(" "),s("h5",{attrs:{id:"新建文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建文件"}},[a._v("#")]),a._v(" 新建文件")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vi /data/kafka_2.12-2.3.0/config/kafka_client_jaas.conf\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("新增以下内容")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('KafkaClient {\n  org.apache.kafka.common.security.plain.PlainLoginModule required\n  username="wuxiaoku"\n  password="xiaoku-lzx22247a";\n};\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[s("img",{attrs:{src:e(350),alt:"note"}})]),a._v(" "),s("h5",{attrs:{id:"修改客户端脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改客户端脚本"}},[a._v("#")]),a._v(" 修改客户端脚本")]),a._v(" "),s("p",[a._v("消费者：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vi /data/kafka_2.12-2.3.0/config/consumer.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("最后一行加上如下配置")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("security.protocol=SASL_PLAINTEXT\nsasl.mechanism=PLAIN\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[s("img",{attrs:{src:e(351),alt:"note"}}),a._v("\n生产者：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vi /data/kafka_2.12-2.3.0/config/producer.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("最后一行加上如下配置")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("security.protocol=SASL_PLAINTEXT\nsasl.mechanism=PLAIN\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[s("img",{attrs:{src:e(352),alt:"note"}})]),a._v(" "),s("h5",{attrs:{id:"增加用户配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#增加用户配置"}},[a._v("#")]),a._v(" 增加用户配置")]),a._v(" "),s("p",[a._v("消费者：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vi /data/kafka_2.12-2.3.0/bin/kafka-console-consumer.sh\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("增加以下内容")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('export KAFKA_OPTS="-Djava.security.auth.login.config=/data/kafka_2.12-2.3.0/config/kafka_client_jaas.conf"\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:e(353),alt:"note"}})]),a._v(" "),s("p",[a._v("生产者：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vi /data/kafka_2.12-2.3.0/bin/kafka-console-producer.sh\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("增加以下内容")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('export KAFKA_OPTS="-Djava.security.auth.login.config=/data/kafka_2.12-2.3.0/config/kafka_client_jaas.conf"\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:e(354),alt:"note"}})]),a._v(" "),s("h5",{attrs:{id:"重启"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重启"}},[a._v("#")]),a._v(" 重启")]),a._v(" "),s("p",[a._v("关闭命令：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cd /data/kafka_2.12-2.3.0\nbin/kafka-server-stop.sh config/server.properties\nbin/zookeeper-server-stop.sh config/zookeeper.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("启动：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("bin/zookeeper-server-start.sh -daemon config/zookeeper.properties\nbin/kafka-server-start.sh -daemon  config/server.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h5",{attrs:{id:"设置用户权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置用户权限"}},[a._v("#")]),a._v(" 设置用户权限")]),a._v(" "),s("p",[a._v("可百度 kfaka ACL")]),a._v(" "),s("p",[a._v("赋权：add 移除：remove 读：Read 写：Write")]),a._v(" "),s("p",[a._v("设置白名单：--allow-host 192.168.213.200")]),a._v(" "),s("p",[a._v("设置组权限：--group 设置topic权限--topic")]),a._v(" "),s("p",[a._v("对wuxiaoku用户的组test-consumer-group设置所有权限")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("bin/kafka-acls.sh --authorizer kafka.security.auth.SimpleAclAuthorizer --authorizer-properties zookeeper.connect=192.168.213.203:2181 --add --allow-principal User:wuxiaoku --operation All --group test-consumer-group\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("对wuxiaoku用户赋权topic读权限")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("bin/kafka-acls.sh --authorizer-properties zookeeper.connect=192.168.213.203:2181 --add  --allow-principal User:wuxiaoku  --allow-host '*' --operation Read --topic tpc.test001\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("对wuxiaoku用户移除topic读权限")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("bin/kafka-acls.sh --authorizer-properties zookeeper.connect=192.168.213.203:2181 --remove  --allow-principal User:wuxiaoku  --allow-host '*' --operation Read --topic tpc.test001\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("对wuxiaoku用户赋权topic写权限")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("bin/kafka-acls.sh --authorizer-properties zookeeper.connect=192.168.213.203:2181 --add  --allow-principal User:wuxiaoku  --allow-host '*' --operation Write --topic tpc.test001\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("对wuxiaoku用户移除topic写权限")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("bin/kafka-acls.sh --authorizer-properties zookeeper.connect=192.168.213.203:2181 --remove  --allow-principal User:wuxiaoku  --allow-host '*' --operation Write --topic tpc.test001\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("查看权限")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("bin/kafka-acls.sh --list --authorizer-properties zookeeper.connect=192.168.213.203:2181\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h5",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),s("p",[a._v("开启两个终端")]),a._v(" "),s("p",[a._v("1终端消费者执行命令：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("/data/kafka_2.12-2.3.0/bin/kafka-console-consumer.sh --bootstrap-server 192.168.213.203:9092 --topic  tpc.test001  --from-beginning --consumer.config /data/kafka_2.12-2.3.0/config/consumer.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("2终端生产者执行命令：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("/data/kafka_2.12-2.3.0/bin/kafka-console-producer.sh --broker-list 192.168.213.203:9092 --topic tpc.test001  --producer.config /data/kafka_2.12-2.3.0/config/producer.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("在生产者终端发送随机字符串，在消费者终端能接收数据即正常\n"),s("img",{attrs:{src:e(355),alt:"note"}})]),a._v(" "),s("h3",{attrs:{id:"清除topic下数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#清除topic下数据"}},[a._v("#")]),a._v(" 清除Topic下数据")]),a._v(" "),s("p",[a._v("例topic：cardata")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("1.修改保留时间为10秒\nbin/kafka-configs.sh --zookeeper 127.0.0.1:2181 --entity-type topics --entity-name cardata --alter --add-config retention.ms=10000\n2.查看topic策略\nbin/kafka-configs.sh --zookeeper 127.0.0.1:2181 --describe --entity-type topics --entity-name cardata\n3.等待数据清理后，删除策略\nbin/kafka-configs.sh --zookeeper 127.0.0.1:2181 --entity-type topics --entity-name cardata --alter --delete-config retention.ms\n4.再次查看策略\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);