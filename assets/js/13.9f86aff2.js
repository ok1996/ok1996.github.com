(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{406:function(a,s,t){a.exports=t.p+"assets/img/image-2.39e51153.png"},407:function(a,s,t){a.exports=t.p+"assets/img/rinetd.25f1e6e1.png"},408:function(a,s,t){a.exports=t.p+"assets/img/image-4-1024x886.ca751dd2.png"},409:function(a,s,t){a.exports=t.p+"assets/img/image-3-1024x821.3730abf1.png"},648:function(a,s,t){"use strict";t.r(s);var r=t(7),e=Object(r.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),s("p",[a._v("端口映射就是将内网中的主机的一个端口映射到外网主机的一个端口，提供相应的服务。当用户访问外网IP的这个端口时，服务器自动将请求映射到对应局域网内部的机器上")]),a._v(" "),s("p",[s("img",{attrs:{src:t(406),alt:""}})]),a._v(" "),s("p",[a._v("如图所示")]),a._v(" "),s("p",[a._v("192.168.213.212服务器拥有外网权限，并开放了7070端口。此时在外网环境下需要访问到192.168.213.213服务器的6060端口，就需要在212服务器上做端口映射。将7070端口转发到213服务器的6060端口。")]),a._v(" "),s("h2",{attrs:{id:"实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[a._v("#")]),a._v(" 实现")]),a._v(" "),s("h3",{attrs:{id:"方式一-nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方式一-nginx"}},[a._v("#")]),a._v(" 方式一（Nginx）")]),a._v(" "),s("p",[a._v("配置文件与http同级，如下将本机端口7070转发到213服务器的6060端口")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v(" stream{\n        upstream mysqlmaster {\n                server 192.168.213.213:6060 weight=1;\n        }\n        server {\n                listen 7070;\n                proxy_upload_rate 102400;\n                proxy_download_rate 102400;\n                proxy_pass mysqlmaster;\n        }\n}\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("h3",{attrs:{id:"方式二-firewall"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方式二-firewall"}},[a._v("#")]),a._v(" 方式二（firewall）")]),a._v(" "),s("p",[a._v("在服务器192.168.213.212上执行此下命令")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("1.开启系统ipv4转发\nsysctl -w net.ipv4.ip_forward=1\n或\necho 1 > /proc/sys/net/ipv4/ip_forward\n2.开启防火墙\nsystemctl start firewalld.service\n3.添加端口\nfirewall-cmd --zone=public --add-port=7070/tcp --permanent\n4.开启防火墙端口转发功能\nfirewall-cmd --permanent --add-masquerade\n5.防火墙端口转发，将本地7070端口转发到192.168.213.213端口6060\nfirewall-cmd --permanent --zone=public --add-forward-port=port=7070:proto=tcp:toaddr=192.168.213.213:toport=6060\n6.重启防火墙\nsystemctl restart firewalld.service\n或\nfirewall-cmd --reload\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br")])]),s("p",[a._v("其他命令")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("7.查询开放的端口\nfirewall-cmd --list-ports\n8.查询端口转发列表\nfirewall-cmd --list-forward-ports\n8.查询端口转发功能是否开启\nfirewall-cmd --query-masquerade\n9.删除端口转发\nfirewall-cmd --permanent --zone=public --remove-forward-port=port=7070:proto=tcp:toaddr=192.168.213.213:toport=6060\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h3",{attrs:{id:"方式三-iptables"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方式三-iptables"}},[a._v("#")]),a._v(" 方式三（iptables）")]),a._v(" "),s("p",[a._v("使用nat转发方式")]),a._v(" "),s("h3",{attrs:{id:"方式四-rinetd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方式四-rinetd"}},[a._v("#")]),a._v(" 方式四（rinetd）")]),a._v(" "),s("p",[a._v("若要作为组件连接工具要慎用，参考此篇文章：")]),a._v(" "),s("p",[a._v("rinetd占用CPU较高，导致转发服务异常")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/woshiaotian/article/details/78133195",target:"_blank",rel:"noopener noreferrer"}},[a._v("blog"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("img",{attrs:{src:t(407),alt:""}})]),a._v(" "),s("h2",{attrs:{id:"特殊应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特殊应用"}},[a._v("#")]),a._v(" 特殊应用")]),a._v(" "),s("h3",{attrs:{id:"kafka端口转发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kafka端口转发"}},[a._v("#")]),a._v(" KAFKA端口转发")]),a._v(" "),s("h4",{attrs:{id:"起因"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#起因"}},[a._v("#")]),a._v(" 起因")]),a._v(" "),s("p",[a._v("前提了解"),s("br"),a._v("\nkafka需要设置advertised.listeners可连接地址及端口，例：设置192.196.213.213:9092,微服务则需要使用92.196.213.213:9092这个地址连接"),s("br"),a._v("\n本次设置kafka.ok96.cn:9092")]),a._v(" "),s("p",[a._v("情况：")]),a._v(" "),s("ol",[s("li",[a._v("虚拟机172.16.200.201和172.16.200.202服务器处于同一内网，端口访问无限制")]),a._v(" "),s("li",[a._v("服务器192.168.213.212外网ip为14.215.177.x 开放端口7070")]),a._v(" "),s("li",[a._v("在172.16.200.202服务器上安装了kafka")])]),a._v(" "),s("p",[a._v("需求：")]),a._v(" "),s("ol",[s("li",[a._v("在172.16.200.201服务器上的微服务需要连接kafka")]),a._v(" "),s("li",[a._v("在外网14.215.177.y服务器上的微服务需要连接kafka")])]),a._v(" "),s("p",[a._v("特殊说明：")]),a._v(" "),s("ol",[s("li",[a._v("服务器14.215.177.x外网7070端口不能变换"),s("br"),a._v("\n【若可以直接使用9092则不需要在14.215.177.y上做端口转发啦】")]),a._v(" "),s("li",[a._v("服务器172.16.200.201网络连接不能通过外网ip回流到172.16.200.202"),s("br"),a._v("\n【若可以，则只需将advertised.listeners设置为公网ip即可，不需要再做端口转发，不需要再做hosts映射】")])]),a._v(" "),s("h5",{attrs:{id:"情况图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#情况图"}},[a._v("#")]),a._v(" 情况图")]),a._v(" "),s("p",[s("img",{attrs:{src:t(408),alt:""}})]),a._v(" "),s("h4",{attrs:{id:"解决"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决"}},[a._v("#")]),a._v(" 解决")]),a._v(" "),s("h5",{attrs:{id:"思路流程图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#思路流程图"}},[a._v("#")]),a._v(" 思路流程图")]),a._v(" "),s("p",[s("img",{attrs:{src:t(409),alt:""}})])])}),[],!1,null,null,null);s.default=e.exports}}]);