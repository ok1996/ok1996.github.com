(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{605:function(s,a,e){s.exports=e.p+"assets/img/note.8bjl25057e8.874829e2.png"},606:function(s,a,e){s.exports=e.p+"assets/img/note.3j7a5fl5pgi0.9fe43dba.png"},662:function(s,a,e){"use strict";e.r(a);var n=e(7),t=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"进程pid查找归属容器id"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进程pid查找归属容器id"}},[s._v("#")]),s._v(" 进程PID查找归属容器ID")]),s._v(" "),a("p",[s._v("根据进程PID查找归属容器ID")]),s._v(" "),a("p",[s._v("使用inspect")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker inspect -f '{{.State.Pid}} {{.Id}}' $(docker ps -q) | grep <PID>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:e(605),alt:"note"}})]),s._v(" "),a("p",[s._v("如果PID是容器内运行子进程那docker inspect就无法显示了，使用以下命令")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("for i in  `docker ps |grep Up|awk '{print $1}'`;do echo \\ &&docker top $i &&echo ID=$i; done |grep -A 10  <PID>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:e(606),alt:"note"}})]),s._v(" "),a("h2",{attrs:{id:"进入docker容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入docker容器"}},[s._v("#")]),s._v(" 进入docker容器")]),s._v(" "),a("h3",{attrs:{id:"redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[s._v("#")]),s._v(" redis")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker exec -it redis redis-cli -a 密码\n获取 redis 中所有的 key:\nKEYS *\n//删除当前数据库中的所有Key\nflushdb\n获取过期时间\nttl key\n\nSET runoobkey redis\nDEL runoobkey\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[s._v("#")]),s._v(" mysql")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker exec -it mysql bash\n链接数据库\nmysql -uroot -p\n输入密码后就进入数据库了\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"kafka"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kafka"}},[s._v("#")]),s._v(" kafka")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1.进入容器\ndocker exec -it kafka-zookeeper /bin/sh\n2. 生产者(容器内部使用127.0.0.1:9092)\n./bin/kafka-console-producer.sh --broker-list 127.0.0.1:9092 --topic test \n3. 消费者\n./bin/kafka-console-consumer.sh --bootstrap-server 127.0.0.1:9092 --topic test --from-beginning\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"docker-ps-a"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-ps-a"}},[s._v("#")]),s._v(" docker ps -a")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('只输出docker的ID和Name\ndocker ps --format "{{.ID}}: {{.Names}}"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"删除所有镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除所有镜像"}},[s._v("#")]),s._v(" 删除所有镜像")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker rmi $(docker images -q)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"删除所有docker容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除所有docker容器"}},[s._v("#")]),s._v(" 删除所有docker容器")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker kill $(docker ps -a -q)\ndocker rm $(docker ps -a -q)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"docker镜像导入导出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker镜像导入导出"}},[s._v("#")]),s._v(" docker镜像导入导出")]),s._v(" "),a("p",[s._v("导出")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker save -o mysql5721.tar mysql:5.7.21\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("导入")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker load -i mysql5721.tar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"监听服务-若异常则重启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监听服务-若异常则重启"}},[s._v("#")]),s._v(" 监听服务，若异常则重启")]),s._v(" "),a("h3",{attrs:{id:"脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本"}},[s._v("#")]),s._v(" 脚本")]),s._v(" "),a("p",[s._v("/home/check/checkDockerServer.sh如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#!/bin/bash\n#当前时间\nnow=`date +"%Y-%m-%d %H:%M:%S"`\n#获取所有容器\narr=`docker ps --format "{{.Names}}"`\n#清空正常的日志\necho " " >/home/check/checkDocker.log\n#循环\nfor item in ${arr[*]}\ndo\n   # 查看进程是否存在\n   exist=`docker inspect --format \'{{.State.Running}}\' ${item}`\n\n    if [ "${exist}" != "true" ]\n    then {\n        echo "${now} 重启docker容器，容器：${item}" >> /home/check/restartDockerServer.log\n        docker restart ${item}\n    }\n    else\n    {\n      echo "${now} 容器：${item} 正常" >>/home/check/checkDocker.log\n    }\n    fi\ndone\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("h3",{attrs:{id:"检查脚本是否能够正常启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查脚本是否能够正常启动"}},[s._v("#")]),s._v(" 检查脚本是否能够正常启动")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" sh /home/check/checkDockerServer.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"加入定时任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加入定时任务"}},[s._v("#")]),s._v(" 加入定时任务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" crontab -e\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("每个一分钟执行一次脚本")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("*/1 * * * * sh /home/check/checkDockerServer.sh >/dev/null 2>&1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"构建镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建镜像"}},[s._v("#")]),s._v(" 构建镜像")]),s._v(" "),a("p",[s._v("例：基于openjdk:8-jre")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("配置文件：/home/application.yml或/home/application.properties\njar包：/app.jar\n时区：上海\n其他：更新apt-get，安装zip、unzip\n可根据实际需求增删相关配置\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("Dockerfile")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM openjdk:8-jre\nRUN sh -c \'touch /app.jar\'\nENV TZ=Asia/Shanghai\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone\nENTRYPOINT ["java","-Xmx800m","-Dspring.config.location=/home/application.yml,/home/application.properties","-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]\nRUN apt-get update -y &&apt-get install -y zip unzip\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("构建命令：openjdk-jar 镜像，版本号8，根据当前目录Dockerfile文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker build -t openjdk-jar:8 ./\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);