<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Prometheus部署及使用 | 北山小库</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/20230310/logo.3mn8xlqm9oy0.webp">
    <meta name="description" content="小渔村的板砖师傅">
    <meta name="keywords" content="小渔村的板砖师傅">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.b5b3c98c.css" as="style"><link rel="preload" href="/assets/js/app.a4313708.js" as="script"><link rel="preload" href="/assets/js/4.c82850c7.js" as="script"><link rel="preload" href="/assets/js/6.977c7f70.js" as="script"><link rel="preload" href="/assets/js/5.778263a8.js" as="script"><link rel="prefetch" href="/assets/js/10.8fe1aa57.js"><link rel="prefetch" href="/assets/js/100.c6265417.js"><link rel="prefetch" href="/assets/js/101.2816e31b.js"><link rel="prefetch" href="/assets/js/102.3494ee15.js"><link rel="prefetch" href="/assets/js/103.8ddc3930.js"><link rel="prefetch" href="/assets/js/104.d23f8b26.js"><link rel="prefetch" href="/assets/js/105.29572fb6.js"><link rel="prefetch" href="/assets/js/106.924943a8.js"><link rel="prefetch" href="/assets/js/107.704857fe.js"><link rel="prefetch" href="/assets/js/108.5fb08cf7.js"><link rel="prefetch" href="/assets/js/109.fa1e7b9c.js"><link rel="prefetch" href="/assets/js/11.90c991ae.js"><link rel="prefetch" href="/assets/js/110.2c98b387.js"><link rel="prefetch" href="/assets/js/111.c697426b.js"><link rel="prefetch" href="/assets/js/112.ad27b832.js"><link rel="prefetch" href="/assets/js/113.2ae3458d.js"><link rel="prefetch" href="/assets/js/114.b66ed55c.js"><link rel="prefetch" href="/assets/js/115.348b2531.js"><link rel="prefetch" href="/assets/js/116.a51a8a11.js"><link rel="prefetch" href="/assets/js/117.4f131a11.js"><link rel="prefetch" href="/assets/js/118.69a16639.js"><link rel="prefetch" href="/assets/js/119.c93746de.js"><link rel="prefetch" href="/assets/js/12.2dbe0ddd.js"><link rel="prefetch" href="/assets/js/120.b0d70468.js"><link rel="prefetch" href="/assets/js/121.2c87c46a.js"><link rel="prefetch" href="/assets/js/122.64a9d395.js"><link rel="prefetch" href="/assets/js/123.26e35e1b.js"><link rel="prefetch" href="/assets/js/124.14d43881.js"><link rel="prefetch" href="/assets/js/125.dcd5466b.js"><link rel="prefetch" href="/assets/js/126.01decb4e.js"><link rel="prefetch" href="/assets/js/127.97e8c8f1.js"><link rel="prefetch" href="/assets/js/128.b8b943e6.js"><link rel="prefetch" href="/assets/js/129.a8a83238.js"><link rel="prefetch" href="/assets/js/13.69e004ba.js"><link rel="prefetch" href="/assets/js/130.38947726.js"><link rel="prefetch" href="/assets/js/131.8ec93d25.js"><link rel="prefetch" href="/assets/js/132.9187f27e.js"><link rel="prefetch" href="/assets/js/133.1709a7c7.js"><link rel="prefetch" href="/assets/js/134.8bbe0fa1.js"><link rel="prefetch" href="/assets/js/135.f9129f79.js"><link rel="prefetch" href="/assets/js/136.eeb013fa.js"><link rel="prefetch" href="/assets/js/137.682185cb.js"><link rel="prefetch" href="/assets/js/138.cb3d1984.js"><link rel="prefetch" href="/assets/js/139.b3c3df8e.js"><link rel="prefetch" href="/assets/js/14.ec7e3525.js"><link rel="prefetch" href="/assets/js/140.19c212a8.js"><link rel="prefetch" href="/assets/js/141.28dfb3c6.js"><link rel="prefetch" href="/assets/js/142.bea12ab4.js"><link rel="prefetch" href="/assets/js/143.f19400d6.js"><link rel="prefetch" href="/assets/js/144.a5295a6c.js"><link rel="prefetch" href="/assets/js/145.c62dfd9c.js"><link rel="prefetch" href="/assets/js/146.fa297fc6.js"><link rel="prefetch" href="/assets/js/147.dde91e66.js"><link rel="prefetch" href="/assets/js/148.4518c940.js"><link rel="prefetch" href="/assets/js/149.9d165f70.js"><link rel="prefetch" href="/assets/js/15.d55b31ac.js"><link rel="prefetch" href="/assets/js/150.a1b474c9.js"><link rel="prefetch" href="/assets/js/151.d875c02c.js"><link rel="prefetch" href="/assets/js/152.ae89dacf.js"><link rel="prefetch" href="/assets/js/153.2cf2539b.js"><link rel="prefetch" href="/assets/js/154.3dc12531.js"><link rel="prefetch" href="/assets/js/155.efeaeae6.js"><link rel="prefetch" href="/assets/js/156.70bcf7a0.js"><link rel="prefetch" href="/assets/js/157.c92fdf83.js"><link rel="prefetch" href="/assets/js/158.840c79ae.js"><link rel="prefetch" href="/assets/js/159.a3e3856c.js"><link rel="prefetch" href="/assets/js/16.ad9eba60.js"><link rel="prefetch" href="/assets/js/160.1d85aa7c.js"><link rel="prefetch" href="/assets/js/161.cd71c6c9.js"><link rel="prefetch" href="/assets/js/162.bad6430e.js"><link rel="prefetch" href="/assets/js/163.ad87d374.js"><link rel="prefetch" href="/assets/js/164.45f2712b.js"><link rel="prefetch" href="/assets/js/165.096d5cd4.js"><link rel="prefetch" href="/assets/js/166.7f9289df.js"><link rel="prefetch" href="/assets/js/167.a96c1fe3.js"><link rel="prefetch" href="/assets/js/168.9c93dc55.js"><link rel="prefetch" href="/assets/js/17.43e6fb02.js"><link rel="prefetch" href="/assets/js/18.8b73e21e.js"><link rel="prefetch" href="/assets/js/19.beacd126.js"><link rel="prefetch" href="/assets/js/2.abf087c2.js"><link rel="prefetch" href="/assets/js/20.eba1ea78.js"><link rel="prefetch" href="/assets/js/21.ec847337.js"><link rel="prefetch" href="/assets/js/22.e73fb9a1.js"><link rel="prefetch" href="/assets/js/23.9b160473.js"><link rel="prefetch" href="/assets/js/24.26d78266.js"><link rel="prefetch" href="/assets/js/25.3dc0f5f1.js"><link rel="prefetch" href="/assets/js/26.1fd41081.js"><link rel="prefetch" href="/assets/js/27.b93b1ab1.js"><link rel="prefetch" href="/assets/js/28.464db53c.js"><link rel="prefetch" href="/assets/js/29.258814bd.js"><link rel="prefetch" href="/assets/js/3.b9881074.js"><link rel="prefetch" href="/assets/js/30.9b7f91c5.js"><link rel="prefetch" href="/assets/js/31.8b8ac4f1.js"><link rel="prefetch" href="/assets/js/32.af4c91c6.js"><link rel="prefetch" href="/assets/js/33.abefafd5.js"><link rel="prefetch" href="/assets/js/34.e832dd2d.js"><link rel="prefetch" href="/assets/js/35.5422d292.js"><link rel="prefetch" href="/assets/js/36.3c068129.js"><link rel="prefetch" href="/assets/js/37.9397f8d4.js"><link rel="prefetch" href="/assets/js/38.8daca339.js"><link rel="prefetch" href="/assets/js/39.b83e55d6.js"><link rel="prefetch" href="/assets/js/40.dcef9167.js"><link rel="prefetch" href="/assets/js/41.2d956153.js"><link rel="prefetch" href="/assets/js/42.ff020021.js"><link rel="prefetch" href="/assets/js/43.7fb9edb4.js"><link rel="prefetch" href="/assets/js/44.53813c12.js"><link rel="prefetch" href="/assets/js/45.b381e70f.js"><link rel="prefetch" href="/assets/js/46.cc1a5b2c.js"><link rel="prefetch" href="/assets/js/47.3c1974c0.js"><link rel="prefetch" href="/assets/js/48.0538ccac.js"><link rel="prefetch" href="/assets/js/49.c002630d.js"><link rel="prefetch" href="/assets/js/50.43eb116d.js"><link rel="prefetch" href="/assets/js/51.d3869f1e.js"><link rel="prefetch" href="/assets/js/52.16d6d398.js"><link rel="prefetch" href="/assets/js/53.9884a477.js"><link rel="prefetch" href="/assets/js/54.4541a653.js"><link rel="prefetch" href="/assets/js/55.51b83d6e.js"><link rel="prefetch" href="/assets/js/56.de88326d.js"><link rel="prefetch" href="/assets/js/57.4c06e1c5.js"><link rel="prefetch" href="/assets/js/58.14df40f4.js"><link rel="prefetch" href="/assets/js/59.c5423049.js"><link rel="prefetch" href="/assets/js/60.0a17a3b4.js"><link rel="prefetch" href="/assets/js/61.8b7b94b1.js"><link rel="prefetch" href="/assets/js/62.d0ad7349.js"><link rel="prefetch" href="/assets/js/63.95c2ca72.js"><link rel="prefetch" href="/assets/js/64.ae87667f.js"><link rel="prefetch" href="/assets/js/65.b87d56f6.js"><link rel="prefetch" href="/assets/js/66.71ac47ee.js"><link rel="prefetch" href="/assets/js/67.6e5e4f87.js"><link rel="prefetch" href="/assets/js/68.464bd6b1.js"><link rel="prefetch" href="/assets/js/69.e6721c11.js"><link rel="prefetch" href="/assets/js/7.2f4f5bcd.js"><link rel="prefetch" href="/assets/js/70.df0b499a.js"><link rel="prefetch" href="/assets/js/71.c1976c2c.js"><link rel="prefetch" href="/assets/js/72.0ee636eb.js"><link rel="prefetch" href="/assets/js/73.a7201e6c.js"><link rel="prefetch" href="/assets/js/74.699b1d11.js"><link rel="prefetch" href="/assets/js/75.567cc194.js"><link rel="prefetch" href="/assets/js/76.695c0d73.js"><link rel="prefetch" href="/assets/js/77.efc91aa2.js"><link rel="prefetch" href="/assets/js/78.9d7e06ea.js"><link rel="prefetch" href="/assets/js/79.77469577.js"><link rel="prefetch" href="/assets/js/8.c213ad19.js"><link rel="prefetch" href="/assets/js/80.9ec68687.js"><link rel="prefetch" href="/assets/js/81.7cf1cf31.js"><link rel="prefetch" href="/assets/js/82.4eba8be3.js"><link rel="prefetch" href="/assets/js/83.df222211.js"><link rel="prefetch" href="/assets/js/84.bb11a95e.js"><link rel="prefetch" href="/assets/js/85.27f8ed92.js"><link rel="prefetch" href="/assets/js/86.0d48ef4b.js"><link rel="prefetch" href="/assets/js/87.ab7a5dda.js"><link rel="prefetch" href="/assets/js/88.d5d28440.js"><link rel="prefetch" href="/assets/js/89.977564f6.js"><link rel="prefetch" href="/assets/js/9.895566d5.js"><link rel="prefetch" href="/assets/js/90.54dd0933.js"><link rel="prefetch" href="/assets/js/91.9965ae38.js"><link rel="prefetch" href="/assets/js/92.98291ee6.js"><link rel="prefetch" href="/assets/js/93.aa266c40.js"><link rel="prefetch" href="/assets/js/94.264040ac.js"><link rel="prefetch" href="/assets/js/95.d404b3ba.js"><link rel="prefetch" href="/assets/js/96.883d2d66.js"><link rel="prefetch" href="/assets/js/97.eff691ed.js"><link rel="prefetch" href="/assets/js/98.c5cf538c.js"><link rel="prefetch" href="/assets/js/99.4f1b14a6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b5b3c98c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><!----> <span class="title" style="display:;">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8e9dc3400/" class="nav-link">2023.4.0.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3410/" class="nav-link">2023.4.1.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3500/" class="nav-link">2023.5.0.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p510/" class="nav-link">2023.5.1.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p520/" class="nav-link">2023.5.2.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p24100/" class="nav-link">2024.1.0.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p24110/" class="nav-link">2024.1.1.0</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分类" class="dropdown-title"><!----> <span class="title" style="display:;">技术分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/note/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/note/deploy/" class="nav-link">Deploy</a></li><li class="dropdown-item"><!----> <a href="/note/application/" class="nav-link">Application</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友情链接</a></div> <a href="https://github.com/ok1996" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/20230310/logo.3mn8xlqm9oy0.webp"> <div class="blogger-info"><h3>Xiao ku</h3> <span>板砖师傅</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><!----> <span class="title" style="display:;">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8e9dc3400/" class="nav-link">2023.4.0.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3410/" class="nav-link">2023.4.1.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3500/" class="nav-link">2023.5.0.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p510/" class="nav-link">2023.5.1.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p520/" class="nav-link">2023.5.2.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p24100/" class="nav-link">2024.1.0.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p24110/" class="nav-link">2024.1.1.0</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分类" class="dropdown-title"><!----> <span class="title" style="display:;">技术分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/note/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/note/deploy/" class="nav-link">Deploy</a></li><li class="dropdown-item"><!----> <a href="/note/application/" class="nav-link">Application</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友情链接</a></div> <a href="https://github.com/ok1996" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/74ea91/" class="sidebar-link">Docker一键部署</a></li><li><a href="/pages/d04772/" class="sidebar-link">Mysql主从配置一键化</a></li><li><a href="/pages/b6e922/" class="sidebar-link">Mysql新建主从同步-mysqldump</a></li><li><a href="/pages/3c702b/" class="sidebar-link">SkyWalking部署及使用</a></li><li><a href="/pages/bb3405/" aria-current="page" class="active sidebar-link">Prometheus部署及使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/bb3405/#基础架构" class="sidebar-link">基础架构</a></li><li class="sidebar-sub-header level2"><a href="/pages/bb3405/#启动基础架构" class="sidebar-link">启动基础架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#上传部署包-解压赋权" class="sidebar-link">上传部署包，解压赋权</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#修改配置文件" class="sidebar-link">修改配置文件</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#启动" class="sidebar-link">启动</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#访问" class="sidebar-link">访问</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#添加数据源" class="sidebar-link">添加数据源</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#引入面板" class="sidebar-link">引入面板</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#效果" class="sidebar-link">效果</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/bb3405/#基础-mysql-redis" class="sidebar-link">基础+Mysql+Redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#架构图" class="sidebar-link">架构图</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#mysql和redis部署包" class="sidebar-link">Mysql和Redis部署包</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#监听mysql" class="sidebar-link">监听Mysql</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#创建mysql监听用户" class="sidebar-link">创建Mysql监听用户</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#启动mysqld-exporter" class="sidebar-link">启动mysqld exporter</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#修改配置文件并重启" class="sidebar-link">修改配置文件并重启</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#查看状态" class="sidebar-link">查看状态</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#引入面板-2" class="sidebar-link">引入面板</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#效果-2" class="sidebar-link">效果</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#监听redis" class="sidebar-link">监听Redis</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#redis账号信息" class="sidebar-link">redis账号信息</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#启动redis-exporter" class="sidebar-link">启动redis-exporter</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#修改配置文件并重启-2" class="sidebar-link">修改配置文件并重启</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#查看状态-2" class="sidebar-link">查看状态</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#引入面板-3" class="sidebar-link">引入面板</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#效果-3" class="sidebar-link">效果</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/bb3405/#附" class="sidebar-link">附</a></li><li class="sidebar-sub-header level2"><a href="/pages/bb3405/#springboot" class="sidebar-link">Springboot</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#依赖配置" class="sidebar-link">依赖配置</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#配置文件" class="sidebar-link">配置文件</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#注意" class="sidebar-link">注意</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#修改配置文件并重启-3" class="sidebar-link">修改配置文件并重启</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#查看状态-3" class="sidebar-link">查看状态</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#引入面板-4" class="sidebar-link">引入面板</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#效果-4" class="sidebar-link">效果</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/bb3405/#springboot-数据库连接池" class="sidebar-link">springboot-数据库连接池</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#起因" class="sidebar-link">起因</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#解决" class="sidebar-link">解决</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#说明" class="sidebar-link">说明</a></li><li class="sidebar-sub-header level4"><a href="/pages/bb3405/#解决示例" class="sidebar-link">解决示例</a></li><li class="sidebar-sub-header level5"><a href="/pages/bb3405/#引入依赖" class="sidebar-link">引入依赖</a></li><li class="sidebar-sub-header level5"><a href="/pages/bb3405/#增加配置文件" class="sidebar-link">增加配置文件</a></li><li class="sidebar-sub-header level5"><a href="/pages/bb3405/#效果-5" class="sidebar-link">效果</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#参考博客原文" class="sidebar-link">参考博客原文</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/bb3405/#完整部署包" class="sidebar-link">完整部署包</a></li><li class="sidebar-sub-header level2"><a href="/pages/bb3405/#修改时区" class="sidebar-link">修改时区</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#prometheus" class="sidebar-link">prometheus</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/bb3405/#新增对docker监控" class="sidebar-link">新增对Docker监控</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#启动cadvisor" class="sidebar-link">启动cadvisor</a></li><li class="sidebar-sub-header level3"><a href="/pages/bb3405/#引入面板-5" class="sidebar-link">引入面板</a></li></ul></li></ul></li><li><a href="/pages/d23db1/" class="sidebar-link">K8S-CICD</a></li><li><a href="/pages/c5c5bb/" class="sidebar-link">K8S-在线安装</a></li><li><a href="/pages/04f4f5/" class="sidebar-link">K3S-在线安装</a></li><li><a href="/pages/de1358/" class="sidebar-link">K3S-CICD</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/note/deploy/#Deploy" data-v-06970110>Deploy</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/ok1996" target="_blank" title="作者" class="beLink" data-v-06970110>xiaoku</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2023-03-13</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Prometheus部署及使用<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="基础架构"><a href="#基础架构" class="header-anchor">#</a> 基础架构</h2> <p>虚拟机IP：192.168.213.213，本次部署暂不对Alertmanager和dingtalk进行告警测试</p> <p>[<img src="/assets/img/image-2001321.9d5c2229.png" alt="">]</p> <h2 id="启动基础架构"><a href="#启动基础架构" class="header-anchor">#</a> 启动基础架构</h2> <h3 id="上传部署包-解压赋权"><a href="#上传部署包-解压赋权" class="header-anchor">#</a> 上传部署包，解压赋权</h3> <p>部署包</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>链接：https://pan.baidu.com/s/14-zsMG0NFPoeetqfWU2C0g 
提取码：4al9 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>网上下载的部署包</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>链接：https://pan.baidu.com/s/17okgNvIhXx8Sjet12RCUgw 
提取码：dw7j 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>上传部署包之后创建文件夹并赋权</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir -p /home/prom/prometheus/data
mkdir -p /home/prom/grafana
chmod 777 /home/prom/prometheus/data
chmod 777 /home/prom/grafana
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="修改配置文件"><a href="#修改配置文件" class="header-anchor">#</a> 修改配置文件</h3> <p>prometheus.yml，将对应改为IP地址</p> <p><img src="/assets/img/image-2.0ee608fc.png" alt=""></p> <h3 id="启动"><a href="#启动" class="header-anchor">#</a> 启动</h3> <p>进入到docker-compose.yml目录地址</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd /data/prometheus
docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="访问"><a href="#访问" class="header-anchor">#</a> 访问</h3> <p>访问Prometheus： http://IP:9090/targets</p> <p><img src="/assets/img/image-3-1024x411.0e3cc60d.png" alt=""></p> <h3 id="添加数据源"><a href="#添加数据源" class="header-anchor">#</a> 添加数据源</h3> <p>访问Grafana：http://IP:3000 账号密码admin</p> <p>添加数据源：</p> <p><img src="/assets/img/image-4-1024x502.ad8e058e.png" alt=""></p> <h3 id="引入面板"><a href="#引入面板" class="header-anchor">#</a> 引入面板</h3> <p>访问Grafana，ID：11074</p> <p>或中文：12633</p> <p><img src="/assets/img/image-5-1024x487.016bdcdb.png" alt=""></p> <p>选择数据源，导入</p> <p><img src="/assets/img/image-6-1024x751.03246d90.png" alt=""></p> <h3 id="效果"><a href="#效果" class="header-anchor">#</a> 效果</h3> <p>中英文效果图</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>链接：https://pan.baidu.com/s/1X6MrwtjNaymdn4VpkFr9Zg 
提取码：6v71 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="基础-mysql-redis"><a href="#基础-mysql-redis" class="header-anchor">#</a> 基础+Mysql+Redis</h2> <h3 id="架构图"><a href="#架构图" class="header-anchor">#</a> 架构图</h3> <p><img src="/assets/img/image-9-1024x431.7a5f9e55.png" alt=""></p> <h3 id="mysql和redis部署包"><a href="#mysql和redis部署包" class="header-anchor">#</a> Mysql和Redis部署包</h3> <p>部署包</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>链接：https://pan.baidu.com/s/12Rtcl5R7d3HgusjRLiYpNg 
提取码：j0py 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>对这两个文件赋权777</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA4AAAACDCAYAAADcSHVkAAAgAElEQVR4Ae2dz5Mlx3Hf94+TQJFUKHzzf8CLrz4rRIAAARLQggsSIAjix2IJ3HDzwREMHmRbEiXTkmUHNnx1BEGAu5QEUBZ2dndW7ci3+O7m5FR1V+e816/71WciXmRVVmZV5ae/mHqFtzNz7fPPPx/0+v3vfz/wWi+DX/ziFzwfNIoGGjXAfy+Xv5fxvf4yk3jmiRH26XsDWMACDaABNHBaGrgWH2g8DOlPv2GAEYzQABpYuwb4Xj+t0ciI/mm94eF58jzRABpAA481cOkCCBj+40ADaAANoAE0gAbQABpAA2gADZymBp5cAN/8T/8w8IIBGkADaAANoAE0gAbQABpAA2jgdDXABZCLLxd/NIAG0AAaQANoAA2gATSABjrRABfATh40/xfndP8vDs+WZ4sG0AAaQANoAA2gATTQqgEugFwA+b89aAANoAE0gAbQABpAA2gADXSigdkXwGvXrh1UHIeev/Vm7ONsT0vvK653iD0cYk7PbU471jsntzVW9bas5WNb4lv3oLhDzKm5sfwfQDSABtAAGkADaAANoIGaBmZdAA/9pvXQ89cgtPiX3FttrZq/Zf+1mEPMWVur5l96D1PrxfHYr9XR6t/3fK3rEsdBgAbQABpAA2gADaABNLDoBXDqje/U+FKCLe2j5DvUfmpr1fxxH61xljcnNq6zr/7Se5haL47H/lXr3vd8V90P+RwEaAANoAE0gAbQABroRwPNF8B9vGkdm2NsbGlBlvZS8h1iX2PrjI35vbTGWc6cWL/GvtrHWH9szdJYyZetf59zZfdAXj/f4HnWPGs0gAbQABpAA2ggauBKF0B7M+vf0Kov6xeTT9aPWdv88ilGNvoV73NKPuXLah7Zkl8+2Rhrfvlka7E2XhuLfj+X2rKKNSufWflLvrGxWrz3H2L+uH+toXW1Z9noL/UVK6sYs/KZjX7f9+0Yq3l8jNqaX31Z+WXlN1ua34/T5ps0GkADaAANoAE0gAbQwCE10HQBLL1p9b6WthXh43xRJb/3xbbvax7vU7tm414UV5qr5PPxV2lrblk/V8nnx2tty/Nj2Xn8HLW25o5rtsTHHN9XvqwfG2vbmF613Jiv+Ln+2vw1/9j8fg+0nz5DWMACDaABNIAG0AAaQAP718AmL4AlIZTeeMsXreWbz7/8nIqv+fy4nyP6le/9fm2Ny8Y4xdbG/dqKiTnRrxz5/Zq+rXlivPdrDu9rjVdOnMP7/X5qbcX7cfk099iYYmLOlN/P6duaJ/rk9/PS3v83NJjCFA2gATSABtAAGkAD4xqYvACW3sgaVO9vacccPRifK1+M9TG+PRWv2Gjj/H6e2pjmiOPe7+fxft/eV4yf07fj/rSej7lKW/PFdfycPsa3fYxvK0a+aP24xuTz1o/V2hbvx5Rf8o2N+fhaW/m1Nf047fFvVPCBDxpAA2gADaABNIAG9qOB9AXQHoC98fVvfr0v+mtjpbix2NKaFu9zfF9+b/14aT75tLdaf848pbnkK+1Nc2ss7qHVPzVPaV7l+DHtteQrxZd8msPGfNvH+rGxGJ/j9yS/5tFY7Hu/xnyufIqT9TElX8xTvMWqjd3PNy84whENoAE0gAbQABpAA/M1MHoBzLxpnZMzFjs2dmoPuqda7dll6z1UXnbekg7jXNaPvlIevvnfvGAGMzSABtAAGkADaAANzNfA6AVwLlC92b3qG959zTN3/8TPF9ASzKSHzFrKvaom56x9jDXn7I/Ydeqc58JzQQNoAA2gATSABpbQwF4vgEtsmDX4DwMNoAE0gAbQABpAA2gADaABNJDTABdA96cDEFFORHCDGxpAA2gADaABNIAG0AAa2IYGuAByAeSXk6ABNIAG0AAaQANoAA2gATTQiQaeXACf/e6rAy8YoAE0gAbQABpAA2gADaABNIAGTlcDFy6AA18QgAAEIAABCEAAAhCAAAQgcLIEuACe7KOlsK0S+OKLL4pbr/mLwTghAIG9E/jkk0/2PicTbpcAetjus1vzztFV/un0yi5TNxfAvM7IhMBBCNy4cWO4ffv2hbmtb36+IACB4xHIHLLH2y0rH5oAejg04T7nR1f5594ru0zdXADzOiMTAgcj8Pzzzz+5BNrlz/p8QQACxyWQOWSPu2NWPyQB9HBIuv3Oja7yz75Xdpm6uQDmdUYmBA5KwC59P//5z7n8HZQyk0OgnUDmkG2fncitEUAPW3ti29gvuso/p17ZZermApjXGZkQODiBjz766OBrsAAEINBGIHPIts1M1BYJoIctPrX17xld5Z9Rr+wydXMBzOuMTAhAAAIQ6IhA5pDtCE93paKH7h75IgWjqzzmXtll6uYCmNcZmRCAAAQg0BGBzCHbEZ7uSkUP3T3yRQpGV3nMvbLL1M0FMK8zMiEAAQhAoCMCmUO2IzyrLvXatWt7319GD7aPQ+xlTnFr2MOc/fYWm9GVGLVq61Q1cBV2YrhFm6m7+QLoxaJ2q9C2CJM9QwACEIAABDyBzCHr82kfloB/bxLfn8T+PnYypYfafg6xl7n1rGEPc/fcS/yYrmqaEps5z3VOrOZfux1jZ3v3/NZey5z9TdVdmqv5AihwmuQUhaPasBCAAAQgAIFIIHPIxjnoH4ZAfE8S+4dYdUwPcX3f9+1D7KtlzjXsoWWfPcaM6cp4+Gfn23NZjeWOjc1dZ8n4MXaxpthfcp/7Xmus7tpasy+AAiZbmxg/BCAAAQhA4JQIZA7ZU6p/zbUc4z3JmB7G9jM2thTjNexhqVq3ts6YrqwW/+x8e26dY7ljY3PXWTJ+jF2sKfaX3Oe+1xqru7bW3i6ABtLDVF82bqDmj3H0IQABCEAAAmsgkDlk17DvXvZQe18x5S+Nl3yR45geLL/2pblLMRpTrvqy8svKLxv96ssqzixf6yQwpivbce0Zyl+qSmOyLfP42BhvY2v8GmMX96z+mLUxvWK90e/7vh3zDtEfq7u23uwLoE0UC7O+vtSuWeXHePWxEIAABCAAgTUSyByya6zj1Pek9x++zpJP43HM931b8bJjehjL82NraKse7DoIjOnKdijNyPpdT/n8eK3t15ia24+voT3Gztfra5Q/Wh8zp615luQxVndtH3u5AAqMFa3CazbGKq62QfwQgAAEIACBNRDIHLJr2HePe4jvLWJfTEp+8/mXYqMd00NpXuX7Md+28dK6Psa3fbzm9j7NpTGf69sax66DwJiubIf+2fl2HPPVWNxY7NjY1Dx+/NjtMXZjNYrPVIzq8/E+x7cVu4Qdq7u2fuoCaJP5Iktt+aKNubWN4YcABCAAAQisiUDmkF3T/k95L3qvoRqn+rU488dcxUY7poc4h+8fou335uev+WsxPp72cQiM6cp25J+db8cx7T7GlPwxJvaVIzs1rril7Ri7uGffV1tW+/b9WluxZn2M9x+6PVZ3be3mC6AVpVepSI156+PM779inB+jDQEIQAACEFgbgcwhu7YaTnU//j1F6/uNTI7nN6UHP7/yok/90rjGZC3Gt33f/P5LcWP+OObzaR+PwJiu4nNV33ardum5xrFaX1XH8Th/aQ3lHtOOsYs1+H2qHtlSrJgoT33lxL7ilrBTdZf20HwBLCXjgwAEIAABCPRCIHPI9sKmxzqPrQe98RT72Jcfuy0C+9ZV1EXsb4vO+G73zW58tfWMZurmArie58dOIAABCEBgxQQyh+yKy2FrVySwBj3Ym3m9rlgO6SshcAhdSSOnfPmzx3cIdiuRxeg2MnVzARxFyiAEIAABCEDgMYHMIQu70yWAHk732R6zMnSVp98ru0zdXADzOiMTAhCAAAQ6IpA5ZDvC012p6KG7R75Iwegqj7lXdpm6uQDmdUYmBCAAAQh0RCBzyHaEp7tS0UN3j3yRgtFVHnOv7DJ1cwHM64xMCEAAAhDoiEDmkO0IT3eloofuHvkiBaOrPOZe2WXq5gKY1xmZEIAABCDQEYHMIdsRnu5KRQ/dPfJFCkZXecy9ssvUzQUwrzMyIQABCECgIwKZQ7YjPN2Vih66e+SLFIyu8ph7ZZepu3gB/M//5+El+r//hz8evvif3xy++PtvDp/b6+++Ofzz//jG49evvjH803//+u71j3/79eHz//0fLuXjgAAEIAABCGyZwN3/929b3j573zMB9LBnoEy3I4Cu8kLolV2m7uYLoF3+hru3huHu+8Nw971huPPuMNx5exju/HQYfvuTYfjtm8Pw2RvD8Nnrw+/+5o/yT49MCEAAAhCAwAoJZA7ZFZbBlvZEAD3sCSTTXCCAri7gmNXplV2m7vYL4N/bBXD68jd89sPhd7/kAjhLsQRDAAIQgMDqCWQO2dUXxQbTBNBDGh2JIwTQ1QiciaFe2WXqbr4A2j/7nPrkzy5/w6c3hrtcACckyjAEIAABCGyNQOaQ3VqN7LedwNr0cO3atfbND8MwN37W5ASnCaxNV+lCjpDYK7tM3e0XwL/75ug/+9Tlb/j0B8Pdv/7aER47S0IAAhCAAAQORyBzyB5uN8x8bAJTerALll5+r/LFC1jNb7kx1s9XGx/L8WNT6/rYuG7sx1g/t9oxJ/YVNzZXzBnrj80Tx8bmWWpsSldL7WOL6/TKLlN38wXQfuFL7Wf+/OVv+PT6cOevuABu8T8c9gwBCEAAAnUCmUO2PhsjWycwpod4sVBfVrWrLxv91rexOK442Tg+laN42dI8fsy3FRutxcS42I85sR/j1ZdVfOzLH63FjcWOjcW5luqP6WqpPWx1nSXZrUk7mbpnXgAv/8KXePkbfvPnXAC3+l8O+4YABCAAgSqBzCFbnYyBzRMY00N8c6i+rIpXXzb6a335zcZc+Up+jSk/xqgvq7hWG/NiP84Tx2v9ml/zxXHvHxtT3JrsmK7WtM817mVJdjVdHYNLpu72C+CvvvHkt31+61vf2v22z9Llb/jNy8Odv3zmGPWzJgQgAAEIQOBgBDKH7ME2w8RHJ9CqB/9G0betgNif4xOAOIf6soqTbfErxqzayh+zMVb5smO5cczPFdu+H/PUV4ys/LI1v8aPZcd0ZXvWvmPb9uvH1Pe+1rbmjnbunDFf/TiP9ffxlWGndf3e5DNb8ssn6+OP0R6ru7af5gug/Z0/+1MPdvl75plndtZ+4Yv9zJ/9s0/75M8uf//26+8Ov/1vzwyPHv5LbU38EIAABCAAgc0RyByymyuSDTcTaNGDvUH0X3P7yo15Nb+P8+1afM1vuT7ft5VTsjFuql+aw3wxTz75ZVvyS7ElX22upf1TurK9x/2rH624eat6SvNorGRLc2tejZXyok+xsnH8Kv0MO1vP76WlHXOusud95E7VXVpj1gVQlz+7AD69BD69/A2/+f7wz7/698Pvfvknwz/9r/9YWg8fBCAAAQhAYJMEMofsJgtl000EpvTg30hqwujzfd9WvGxtLPqtH1+aw2yMb/WV8vy8ak/FTY3X9qP5ZafmsfH4Um7rGj5+yXZGV6pJNcf9lniVfDEv9ks5JV/Mi/1MTpyj1L8KO83n91ZrW6wfU+6x7FTdpX01XwD/8W+//uSffdrlL37yZ5e/4ZOXdp/+nf/fb+9saUF8EIAABCAAgS0SyByyW6yTPbcRGNND7c1h9KsvW1u5NF7y+fw4HvsWW/KV/LU4v15L3tQ8tXHv9+24fqlfii/5SrnH8I3pyvZT27v8stq7+rLRr/6UVb6s4mNf/ppVvGwtLuO/Kjtb0++r1o5xmb3uM2eq7tJa7RfAv/mjQT/z9/gCePGTP7v8DZ+8OHz2X//wqQ0repB+qOb3MbQhAAEIQAACxySQOWSPuV/WPiyBMT3Y+5r40m68v+TTeGlMPrMWV/vSHD7Gt5Xn49Qujck3ZpUf16n5ba6xWOVpzdiXvzSPxpRTWkcxa7Otuor7Vo2yNq76a20fG+fz/UPP49e6SjvLztb0Nfo9TPlbGfo5990eq7u2VvMF8Hd2AfzqZ/7iPwXVPwkdfv3C8Nl/+cPhia2tih8CEIAABCCwMQKZQ3ZjJbLdGQSOqYe5bzrnxs/AQOieCRxTV3suZfHpemWXqbv9AvhLuwBe/IUv+mef9smfXfqGXz8/fLq7AH5lF3/0LAgBCEAAAhA4DIHMIXuYnTDrGgighzU8hdPbA7rKP9Ne2WXqbr4A3t1dAMv/7FOXv+HXzw2f/oV9AviVzT9DMiEAAQhAAAKrIpA5ZFdVAJvZKwH0sFecTPYVAXSVl0Kv7DJ1t18A//pruz/wfuevvrb7O3/2px7sZT/zZ//s0z75s8vfb/7iD3b207/8d/knSCYEIAABCEBgZQQyh+zKSmA7eySAHvYIk6meEEBXT1DMbvTKLlN38wVw9lMgAQIQgAAEIHBCBDKH7AmVTymBAHoIQOjuhQC6ymPslV2m7uYL4AcffDDc+tnPhvfff3+4efPm8O677w3vvPPO8NO33x7eeuut4c2f/GS4devWcPfu3fyTIxMCEIAABCCwUgKZQ3alpbCtPRBAD3uAyBSXCKCrS0iaHb2yy9TdfAG0y9+jR4+evM4fPRrOz5++Pvzww+H27dvDezdvDnfucAlsViuBEIAABCCwCQKZQ3YThbHJFAH0kMJG0gQBdDUBaGS4V3aZupsvgPbJn10AHzx8ODx48HC4/+DBcP/+g+Hsq5ddAO/cuTN8/PHHw9vvvDvyeBiCAAQgAAEIbI9A5pDdXpXsuJUAemglRdwcAuhqDq2Lsb2yy9TdfAG0f/ZpF8CPPvro0uvs/v3BLoAvv/zy7vXqjRsXn8gCPf2hxta/dTM3foESWAICEIAABFZMIHPIrrgctnZFAmvTQ+v7H5U9N1552MMSWJuuDlvtfmfvlV2m7uYLoP3Mn10Ad5/8hU//7AJ4dnZ/uHd2f3j48Hy4/uoP9vtEZ8w29xva3PgZWyEUAhCAAAROiEDmkD2h8ldbip3jek1tUnE6+33ft6fmsfEpPdTm25ff79Hm1Fdtfo2bnRsfc7WG95faivNWcSWfxsas5ZW+av5S7Jp9U7pa896Pvbde2WXqbr4A2i98sZ/7K30C6H12AXzl+vWjaWDuN4C58UcrjIUhAAEIQOCoBDKH7FE33MHi8QyP/RICH9PSLs1hvjE9+HktVn1Zzam+bKtfcbLKl41+9WUVJxv96kd71XjNN3cenxdzbcx8Jb/ytmTHdLWlOo6x1yXZrUlvmbqbL4D22z7tl774n/t7/PN/jz/5s0//7p2d7T4BfPmVPz/Gc9+tOfeBzI0/WmEsDAEIQAACRyWQOWSPuuEOFo9neOyXEChGVjG+79saj3ZMDzFffVnNpb5sq19xZn2ub8cx5cQY+WvxY+Nxrqm+5pqKi+M+rzRmvpJfeVuyY7raUh3H2OuS7Nakt0zdzRdA+1MPdgH0n/aV2vYJ4PdffuXSc9d/nLIKGOtrTFY5ZuUz679i34+V2rV4zR9z5JeN4/QhAAEIQOA0CWQO2dMksZ6q4hke+6Wd1s5v+VvmsHlb9eDn822bI/ajL47HfoxX3+JKsRo367/G4mOc+i05ipH1ub5t41NfipFVvPqy8m/VjunKalSdsW31+jH1va+lrbxoW3J9TMxX38eobWP7+Mqw07q2l9J+Sn75ZDXHsexY3bU9NV8A7e/82QVw9/N+7mf+Hn/yd3+4d+9s+PLe408AX/re9y+tJ6jRWqB8Y20/YS0+5vucWtvPpRjva2krDwsBCEAAAqdLIHPIni6NdVTmz2jbUeyXdqkYWcX4vm9rPNoWPcR51taPNcX9xXHrW4ziZEtxivVjPj47T5xD83u/fFu0U7ry3FSfao/Wxks++TW2hnm0h6vYDDux0LqeSa0dc5R7LDtVd2lfzRfAH//4zeH8/LzhE8CHw4svfe/SWoIYrQXKF9vq+3H5zNrX2NhXIaMm5sc547j1o290AQYhAAEIQOAkCGQO2ZMofMVFxPM49ktb9zEt7dIc5pvSg59bc0Sf7/t2S7zFxJy5fa0jG/Plr9l9xU/NY+PxZXuKvql5anWsyZ/RVWQR6ylxKfmOOU/cc6Z/FXZaz3OptcVJOce2U3WX9td8AXz9jTeGh+fnu9/0+eRTv7PHn/rZJ3+715f3dn8n8IUXX7y0liBGq0Dza0w+b/1YrW3xfszn19qleO+rtWvz4YcABCAAgdMkkDlkT5PEeqryZ7TtKvZLO/UxLe3SHOYb04Of1+dHv/qyPtba0e/7vq286PN9326JV4y3fg7f9jG+HWPUl7VY3/a5tXYtvuavzbNW/5iubM+1OuWXVX3qy0a/+rKKk231K05W+bJTfo1fxV6Vna3t91trx7ir7HkfuVN1l9ZovgD+6PXXdxfA0s/9eZ/9ofjnX/jupbUEMVofqDH5rO9f8puNft9XW/HWj1+K8dbHyO991pbfLF8QgAAEINAPgcwh2w+d41U651yOsb7v2y3VjOnBz6W25lTfrL68T+3SmHxmfX70xzky8X5O3y7NrfHSnhQfx+RXrrcxVmPKieM1v/K2ZFt1FWsSE1kbF5da28dqPvlka7ne72Mz8yjnqjbLztcS92C11eqrjcU5Dt0fq7u2dvMF8LUf/mj3Gz6ffNqnT/3u3Rv+9cunL7sAPvf8C7X1qv4S3GqwG8jmuSmam3Gt2G+eiEAIQAACENgcgcwhu7ki2XAzgWPqYe77j7nxzRAI3DuBY+pq78UsPGGv7DJ1N18Ab7z22u4C6D/tK7XtAvjsd77T/Mjtm1L2G5Nys/nNm3SBx1jTLU8TAhCAAASORCBzyB5pqyy7AAH0sADkDpdAV/mH3iu7TN3NF8BXb9zY/XyfXfCmXn/27HP5p0cmBCAAAQhAYIUEMofsCstgS3sigB72BJJpLhBAVxdwzOr0yi5Td/MF8PqrPxheuX59sD/ybn/nz/7Ug/22T/uFL/Yzf/bPPu2TP7v8/em3n531wAiGAAQgAAEIrJ1A5pBde03sL08APeTZkVkngK7qbKZGemWXqbv5AjgFnXEIQAACEIDAKRPIHLKnzKP32tBD7wo4TP3oKs+1V3aZupsvgB988MFw62c/G95///3h5s2bw7vvvje88847w0/ffnt46623BvtD8bdu3Rru3r2bf3JkQgACEIAABFZKIHPIrrQUtrUHAuhhDxCZ4hIBdHUJSbOjV3aZupsvgHb5e/To0ZPX+aNHw/n509eHH3443L59e3jv5s3hzp3Ll0D9opZTt80qJRACEIAABDZFIHPIbqpANjuLAHqYhYvgRgLoqhFUIaxXdpm6my+A9smfXQB3vwDmwcPh/oMHw/37D4azr152Abxz587w8ccfD2+/8+6Fx6JL3wUnHQhAAAIQgMCGCGQO2Q2Vx1ZnEkAPM4ER3kQAXTVhKgb1yi5Td/MF0P7Zp10AS3/64ez+/cEugC+//PLuZb8xdO1f+/5zDlxy1/7E2R8EIACBqxHIHLJXW5HsNRNYmx7mvg+ZG7/mZ3FKe1ubrrbEtld2mbqbL4D2M392Adx98hc+/bML4NnZ/eHe2f3d3wq03xjqv9b8TWbNe/MMaUMAAhCAwHEJZA7Z4+64j9XtHNdrqmLF6ez3fd+emsfGp/RQm29ffr9Hm1Nftfk1bnZufMzVGt5faivOW8WVfBobs5ZX+qr5S7Fr9k3pas17P/beemWXqbv5Ami/8MV+7q/0CaD3PXx4vvtzEccWQev6+/qGsa95WvdNHAQgAAEILEsgc8guu8P+Votnb+yXiPiYlnZpDvON6cHPa7Hqy2pO9WVb/YqTVb5s9KsvqzjZ6Fc/2qvGa7658/i8mGtj5iv5lbclO6arLdVxjL0uyW5NesvU3XwBtN/2ab/0xf/c3+Of/3v8yZ99+nfv7Gz3CaD9rUD/tSZIfl/WXvPe4l7pQwACEIDA8QhkDtnj7baPleMZHvslCoqRVYzv+7bGox3TQ8xXX1ZzqS/b6lecWZ/r23FMOTFG/lr82Hica6qvuabi4rjPK42Zr+RX3pbsmK62VMcx9rokuzXpLVN38wXQ/tSDXQD9p32ltn0CaH8ovvYV/yP1/Za25vWx5vN931Z8zVps6as2h/yyyq3No3EsBCAAAQhsm0DmkN12xevffTx7Y79UQTy/FSN/yxyW06oHP59v2xyxH31xPPZjvPoWV4rVuFn/NRYf49RvyVGMrM/1bRuf+lKMrOLVl5V/q3ZMV1aj6oxtq9ePqe99LW3lRduS62Nivvo+Rm0b28dXhp3Wtb2U9lPyyyerOY5lx+qu7an5Amh/588ugLuf93M/8/f4k7/7w717Z8OX9x5/AvjS975/YT0BlbXB2PZ9JZuv5vcxvl2K13jJluK9r6VdmhcfBCAAAQicFoHMIXtaBNZXjT+jbXexX9qxYmQV4/u+rfFoW/QQ51lbP9YU9xfHrW8xipMtxSnWj/n47DxxDs3v/fJt0U7pynNTfao9Whsv+eTX2Brm0R6uYjPsxELreia1dsxR7rHsVN2lfTVfAH/84zeH8/Pzhk8AHw4vvvS90lpPvmkY0DGoSvYx8pn1/lrbx4+1fb7ivM+3tXb0ya98LAQgAAEInB6BzCF7ehTWVVE8j2O/tFsf09IuzWG+KT34uTVH9Pm+b7fEW0zMmdvXOrIxX/6a3Vf81Dw2Hl+2p+ibmqdWx5r8GV1FFrGeEpeS75jzxD1n+ldhp/U8l1pbnJRzbDtVd2l/zRfA1994Y3h4fr77TZ9PPvU7e/ypn33yt3t9eW/3dwJfePHFC2sJoOyFwcI3MI23xPsY39YcU7aU43219tS8jEMAAhCAwGkRyByyp0VgfdX4M9p2F/ulHfuYlnZpDvON6cHP6/OjX31ZH2vt6Pd931Ze9Pm+b7fEK8ZbP4dv+xjfjjHqy1qsb/vcWrsWX/PX5lmrf0xXtudanfLLqj71ZaNffVnFybb6FSerfNkpv8avYq/Kztb2+621Y9xV9ryP3Km6S2s0XwB/9Ks4PkEAAAa6SURBVPrruwtg6ef+vM/+UPzzL3y3tNbOZzD1MofaHvKYXxMrL/bjPJpLcbLK91ZjyqnNpZwY7/u0IQABCEDgtAhkDtnTIrDOanQml87suOMY6/u+HfNK/TE9+LnU1hzqm9WX96ldGpPPrM+P/jhHJt7P6duluTVe2pPi45j8yvU2xmpMOXG85lfelmyrrmJNYiJr4+JSa/tYzSefbC3X+31sZh7lXNVm2fla4h6stlp9tbE4x6H7Y3XX1m6+AL72wx/tfsPnk0/79KnfvXvDv3759GUXwOeef+HCeiVwFwI20ol1xP5GymCbEIAABCCQIJA5ZBPLkLIRAsfUw9z3H3PjN/IITnKbx9TV1oH2yi5Td/MF8MZrr+0ugP7TvlLbLoDPfuc7W9dQdf/2TVQvH8Q3V0+DNgQgAIHTI5A5ZE+PAhWJAHoQCew+CaCrPM1e2WXqbr4Avnrjxu7n++yCN/X6s2efu/D0uBxdwEEHAhCAAAQ2SCBzyG6wTLbcSAA9NIIibBYBdDUL14XgXtll6m6+AF5/9QfDK9evD/ZH3u3v/NmferDf9mm/8MV+5s/+2ad98meXvz/99rMXHoh1dAk8dXupcBwQgAAEIHASBDKH7EkUThFFAuihiAXnFQmgqzzAXtll6m6+AOYfB5kQgAAEIACB7RPIHLLbr5oKagTQQ40M/qsQQFd5er2yy9TNBTCvMzIhAAEIQKAjAplDtiM83ZWKHrp75IsUjK7ymHtll6mbC2BeZ2RCAAIQgEBHBDKHbEd4uisVPXT3yBcpGF3lMffKLlM3F8C8zsiEAAQgAIGOCGQO2Y7wdFcqeujukS9SMLrKY+6VXaZuLoB5nZEJAQhAAAIdEcgcsh3h6a5U9NDdI1+kYHSVx9wru0zdXADzOiMTAhCAAAQ6IpA5ZDvC012p6KG7R75Iwegqj7lXdpm6uQDmdUYmBCAAAQh0RCBzyHaEp7tS0UN3j3yRgtFVHnOv7DJ1cwHM64xMCEAAAhDoiEDmkO0IT3eloofuHvkiBaOrPOZe2WXq5gKY1xmZEIAABCDQEYHMIdsRnu5KRQ/dPfJFCkZXecy9ssvUzQUwrzMyIQABCECgIwKZQ7YjPN2Vih66e+SLFIyu8ph7ZZepmwtgXmdkQgACEIBARwQyh2xHeLorFT1098gXKRhd5TH3yi5TNxfAvM7IhAAEIACBjghkDtmO8HRXKnro7pEvUjC6ymPulV2mbi6AeZ2RCQEIQAACHRHIHLId4emuVPTQ3SNfpGB0lcfcK7tM3VwA8zojEwIQgAAEOiKQOWQ7wtNdqeihu0e+SMHoKo+5V3aZurkA5nVGJgQgAAEIdEQgc8h2hKe7UtFDd498kYLRVR5zr+wydXMBzOuMTAhAAAIQ6IhA5pDtCE93paKH7h75IgWjqzzmXtll6uYCmNcZmRCAAAQg0BGBzCHbEZ7uSkUP3T3yRQpGV3nMvbLL1M0FMK8zMiEAAQhAoCMCmUO2IzzdlYoeunvkixSMrvKYe2WXqZsLYF5nZEIAAhCAQEcEModsR3i6KxU9dPfIFykYXeUx98ouUzcXwLzOyIQABCAAgY4IZA7ZjvB0Vyp66O6RL1Iwuspj7pVdpm4ugHmdkQkBCEAAAh0RyByyHeHprlT00N0jX6RgdJXH3Cu7TN1cAPM6IxMCEIAABDoikDlkO8LTXanoobtHvkjB6CqPuVd2mbq5AOZ1RiYEIAABCHREIHPIdoSnu1LRQ3ePfJGC0VUec6/sMnVzAczrjEwIQAACEOiIQOaQ7QhPd6Wih+4e+SIFo6s85l7ZZermApjXGZkQgAAEINARgcwh2xGe7kpFD9098kUKRld5zL2yy9TNBTCvMzIhAAEIQKAjAplDtiM83ZWKHrp75IsUjK7ymHtll6mbC2BeZ2RCAAIQgEBHBDKHbEd4uisVPXT3yBcpGF3lMffKLlM3F8C8zsiEAAQgAIGOCGQO2Y7wdFcqeujukS9SMLrKY+6VXaZuLoB5nZEJAQhAAAIdEcgcsh3h6a5U9NDdI1+kYHSVx9wru0zdXADzOiMTAhCAAAQ6IpA5ZDvC012p6KG7R75Iwegqj7lXdpm6uQDmdUYmBCAAAQh0RCBzyHaEp7tS0UN3j3yRgtFVHnOv7DJ1cwHM64xMCEAAAhDoiEDmkO0IT3eloofuHvkiBaOrPOZe2WXq5gKY1xmZEIAABCDQEYHMIdsRnu5KRQ/dPfJFCkZXecy9ssvUzQUwrzMyIQABCECgIwKZQ7YjPN2Vih66e+SLFIyu8ph7ZZep+/8DZkvW6zTZjiEAAAAASUVORK5CYII=" alt=""></p> <h3 id="监听mysql"><a href="#监听mysql" class="header-anchor">#</a> 监听Mysql</h3> <h4 id="创建mysql监听用户"><a href="#创建mysql监听用户" class="header-anchor">#</a> 创建Mysql监听用户</h4> <p>账号：'exporter' 密码：'xxxxxxx'  最大连接数：3</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>CREATE USER 'exporter'@'%' IDENTIFIED BY 'xxxxxxx' WITH MAX_USER_CONNECTIONS 3;
GRANT PROCESS, REPLICATION CLIENT ON *.* TO 'exporter'@'%';
GRANT SELECT ON performance_schema.* TO 'exporter'@'%';
FLUSH PRIVILEGES;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="启动mysqld-exporter"><a href="#启动mysqld-exporter" class="header-anchor">#</a> 启动mysqld exporter</h4> <p>docker-compose.yml</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.1'

services:
  mysql_exporter:
    image: prom/mysqld-exporter:v0.12.1
    restart: always
    container_name: mysql_exporter
    ports:
      - &quot;9104:9104&quot;
    environment:
      - DATA_SOURCE_NAME=exporter:xxxxxxx@(192.168.213.212:3306)/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>或者直接命令启动：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -d -p 9104:9104 -e DATA_SOURCE_NAME=&quot;exporter:xxxxxxx@(192.168.213.212:3306)/&quot; prom/mysqld-exporter:v0.12.1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="修改配置文件并重启"><a href="#修改配置文件并重启" class="header-anchor">#</a> 修改配置文件并重启</h4> <p>prometheus.yml，监控exporter在213中</p> <p><img src="/assets/img/image-7.c351c999.png" alt=""></p> <h4 id="查看状态"><a href="#查看状态" class="header-anchor">#</a> 查看状态</h4> <p>访问Prometheus</p> <p><img src="/assets/img/image-8-1024x561.913c08fa.png" alt=""></p> <h4 id="引入面板-2"><a href="#引入面板-2" class="header-anchor">#</a> 引入面板</h4> <p>访问Grafana</p> <p>mysql-overview_rev5.json</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>链接：https://pan.baidu.com/s/18nH9oiWRv06KBQImn6MjOA 
提取码：xm2v 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="效果-2"><a href="#效果-2" class="header-anchor">#</a> 效果</h4> <p>中英效果图</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>链接：https://pan.baidu.com/s/1FzWnf4tr6nQN8fGBkVRjuA 
提取码：x0bt 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="监听redis"><a href="#监听redis" class="header-anchor">#</a> 监听Redis</h3> <h4 id="redis账号信息"><a href="#redis账号信息" class="header-anchor">#</a> redis账号信息</h4> <p>使用上面部署包，密码为：redis5268</p> <h4 id="启动redis-exporter"><a href="#启动redis-exporter" class="header-anchor">#</a> 启动redis-exporter</h4> <p>docker-compose.yml</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.1'

services:
  redis_exporter:
    image: oliver006/redis_exporter:v1.22.0
    restart: always
    container_name: redis_exporter
    ports:
      - &quot;9121:9121&quot;
    command:
      # 执行的命令
      --redis.addr redis://192.168.213.212:6379 --redis.password 'redis5268'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>或者直接命令启动：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -d --name redis_exporter -p 9121:9121 oliver006/redis_exporter:v1.22.0 --redis.addr redis://192.168.213.212:6379 --redis.password 'redis5268'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="修改配置文件并重启-2"><a href="#修改配置文件并重启-2" class="header-anchor">#</a> 修改配置文件并重启</h4> <p>prometheus.yml，监控exporter在213中</p> <p><img src="/assets/img/image-13.de8af942.png" alt=""></p> <h4 id="查看状态-2"><a href="#查看状态-2" class="header-anchor">#</a> 查看状态</h4> <p><img src="/assets/img/image-14-1024x392.09d0a885.png" alt=""></p> <h4 id="引入面板-3"><a href="#引入面板-3" class="header-anchor">#</a> 引入面板</h4> <p>访问Grafana,ID:763,选择数据源导入</p> <p><img src="/assets/img/image-12-1024x528.f28fbdf0.png" alt=""></p> <h4 id="效果-3"><a href="#效果-3" class="header-anchor">#</a> 效果</h4> <p><img src="/assets/img/2021-04-23_145551-1024x635.27859078.png" alt=""></p> <h2 id="附"><a href="#附" class="header-anchor">#</a> 附</h2> <p>Mysql循环插入数值语句，sdd表，sd字段，id字段值自增</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>delimiter $$     
create procedure pre7()        
begin
declare i int;        
set i=1;
while i&lt;100 do    
    insert into sdd (sd)
    values(i); 
set i=i+1;        
end while;
end 
$$    
 
call pre7();    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="springboot"><a href="#springboot" class="header-anchor">#</a> Springboot</h2> <p>参考文章：https://zhuanlan.zhihu.com/p/366323778</p> <h3 id="依赖配置"><a href="#依赖配置" class="header-anchor">#</a> 依赖配置</h3> <p>我们演示的SpringBoot为2.0+，因此直接选择 io.micrometer 的依赖包来实现；更低版本的不能使用这种姿势，可以直接使用官方提供的client来实现；这里不进行扩展</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>        &lt;dependency&gt;
            &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
            &lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h3> <p>增加以下参数</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>management:
  endpoints:
    web:
      exposure:
        include: &quot;*&quot;
  metrics:
    tags:
      application: ${spring.application.name}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h4> <ul><li>management.endpoints.web.exposure.include 这里指定所有的web接口都会上报</li> <li>metrics.tags.application 这个应用所有上报的metrics 都会带上 application 这个标签</li></ul> <p>上面配置完毕之后，会提供一个 /actuator/prometheus 的端点，供prometheus来拉取Metrics信息</p> <p>工程日志：“EndpointLinksResolver - Exposing 22 endpoint(s) beneath base path '/slam-service/actuator'” slam-service为工程名称</p> <h3 id="修改配置文件并重启-3"><a href="#修改配置文件并重启-3" class="header-anchor">#</a> 修改配置文件并重启</h3> <p>prometheus.yml</p> <p><img src="/assets/img/image-15-1024x716.8a706aa7.png" alt=""></p> <p>prometheus.yml</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>global:
  scrape_interval:     15s
  evaluation_interval: 15s

alerting:
  alertmanagers:
  - static_configs:
    - targets:
      - alertmanager:9093

rule_files:
  - &quot;*rules.yml&quot;
  
scrape_configs:
  - job_name: 'prometheus'
    static_configs:
    - targets: ['192.168.213.213:9090']

  - job_name: 'node'
    static_configs:
    - targets: ['192.168.213.213:9100']
    - targets: ['192.168.213.212:9100']


  - job_name: 'alertmanager'
    static_configs:
    - targets: ['192.168.213.213:9093']

  - job_name: 'mysql_exporter'
    static_configs:
    - targets: ['192.168.213.213:9104']

  - job_name: 'redis_exporter'
    static_configs:
    - targets: ['192.168.213.213:9121']
      labels:
        operator: 'imbiaoqian'

  - job_name: 'springboot_exporter'
    metrics_path: '/slam-service/actuator/prometheus'
    static_configs:
    - targets: ['192.168.213.213:21270']
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="查看状态-3"><a href="#查看状态-3" class="header-anchor">#</a> 查看状态</h3> <p>访问Prometheus</p> <p><img src="/assets/img/image-16-1024x396.d5c4b7d5.png" alt=""></p> <h3 id="引入面板-4"><a href="#引入面板-4" class="header-anchor">#</a> 引入面板</h3> <p>访问Grafana，ID：12856</p> <h3 id="效果-4"><a href="#效果-4" class="header-anchor">#</a> 效果</h3> <p><img src="/assets/img/image-18-1024x498.6363b9f6.png" alt=""></p> <h2 id="springboot-数据库连接池"><a href="#springboot-数据库连接池" class="header-anchor">#</a> springboot-数据库连接池</h2> <h3 id="起因"><a href="#起因" class="header-anchor">#</a> 起因</h3> <p>在使用Grafana，ID：6756的时候发现页面均无数据</p> <p>排查后发现有两点原因</p> <p>1.变量与springboot上报数据不对应，需在Grafana设置中修改变量查询条件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>【instance】label_values(jvm_classes_loaded_classes, instance)
【application】label_values(jvm_classes_loaded_classes{instance=&quot;$instance&quot;}, application)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>2.页面中没有HikariCP Statistics数值，springboot上报数据也无相关信息。此内容在网上较难查询到，在经过合理推断和部分文章参考得到解决办法</p> <h3 id="解决"><a href="#解决" class="header-anchor">#</a> 解决</h3> <h4 id="说明"><a href="#说明" class="header-anchor">#</a> 说明</h4> <p>可参考此篇文章：https://blog.csdn.net/ankeway/article/details/108003149<br>
但文章中示例是使用ShardingJdbc，下文使用的是MybatisPlus中的dynamic-datasource-spring-boot-starter多数据源配置，通过断点bindMetricsRegistryToHikariDataSources入口参数中分析推理，本次数据源采用的是DynamicRoutingDataSource。</p> <p>数据源依赖为</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>        &lt;dependency&gt;
            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
            &lt;artifactId&gt;dynamic-datasource-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>原因与文章一致，都是因为DataSource变化导致为null
<img src="/assets/img/image-2.0ee608fc.png" alt=""></p> <h4 id="解决示例"><a href="#解决示例" class="header-anchor">#</a> 解决示例</h4> <h5 id="引入依赖"><a href="#引入依赖" class="header-anchor">#</a> 引入依赖</h5> <p>在有数据库链接依赖的pom中增加</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>        &lt;dependency&gt;
            &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
            &lt;artifactId&gt;micrometer-core&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="增加配置文件"><a href="#增加配置文件" class="header-anchor">#</a> 增加配置文件</h5> <p>新建文件PoolMetricsAutoConfiguration</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import com.baomidou.dynamic.datasource.DynamicRoutingDataSource;
import com.baomidou.dynamic.datasource.ds.ItemDataSource;
import com.zaxxer.hikari.HikariDataSource;
import com.zaxxer.hikari.metrics.micrometer.MicrometerMetricsTrackerFactory;
import io.micrometer.core.instrument.MeterRegistry;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.actuate.autoconfigure.metrics.MetricsAutoConfiguration;
import org.springframework.boot.actuate.autoconfigure.metrics.export.simple.SimpleMetricsExportAutoConfiguration;
import org.springframework.boot.autoconfigure.AutoConfigureAfter;
import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;
import org.springframework.boot.jdbc.DataSourceUnwrapper;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.log.LogMessage;

import javax.sql.DataSource;
import java.util.Collection;

@Configuration(proxyBeanMethods = false)
@AutoConfigureAfter({MetricsAutoConfiguration.class, DataSourceAutoConfiguration.class,
        SimpleMetricsExportAutoConfiguration.class})
@ConditionalOnClass({DataSource.class, MeterRegistry.class})
@ConditionalOnBean({DataSource.class, MeterRegistry.class})
public class PoolMetricsAutoConfiguration {

    @Configuration(proxyBeanMethods = false)
    @ConditionalOnClass({DynamicRoutingDataSource.class, HikariDataSource.class})
    static class DataSourceMetricsConfiguration {

        private static final Log logger = LogFactory.getLog(DataSourceMetricsConfiguration.class);

        private final MeterRegistry registry;

        DataSourceMetricsConfiguration(MeterRegistry registry) {
            this.registry = registry;
        }

        @Autowired
        void bindMetricsRegistryToHikariDataSources(Collection&lt;DataSource&gt; dataSources) {
            for (DataSource dataSource : dataSources) {
                DynamicRoutingDataSource dynamicRoutingDataSource = DataSourceUnwrapper.unwrap(dataSource, DynamicRoutingDataSource.class);
                Collection&lt;DataSource&gt; dynamicRoutingDataSources = dynamicRoutingDataSource.getCurrentDataSources().values();
                for (DataSource ds : dynamicRoutingDataSources) {
                    HikariDataSource hikariDataSource = null;
                    try {
                       // DataSource dsReal = ((ItemDataSource) ds).getDataSource();//会自动变成ItemDataSource，故手动转换一次
                       // hikariDataSource = DataSourceUnwrapper.unwrap(dsReal, HikariDataSource.class);
                       ItemDataSource itemDataSource = ds.unwrap(ItemDataSource.class);//会自动变成ItemDataSource，故手动转换一次
                        if (itemDataSource!=null){
                            DataSource dsReal = itemDataSource.getDataSource();
                            hikariDataSource = DataSourceUnwrapper.unwrap(dsReal, HikariDataSource.class);
                        }
                    } catch (Exception e) {
                        e.printStackTrace();
                    }

                    if (hikariDataSource != null) {
                        bindMetricsRegistryToHikariDataSource(hikariDataSource);
                    }
                }
            }
        }

        private void bindMetricsRegistryToHikariDataSource(HikariDataSource hikari) {
            if (hikari.getMetricRegistry() == null &amp;&amp; hikari.getMetricsTrackerFactory() == null) {
                try {
                    hikari.setMetricsTrackerFactory(new MicrometerMetricsTrackerFactory(this.registry));
                } catch (Exception ex) {
                    logger.warn(LogMessage.format(&quot;Failed to bind Hikari metrics: %s&quot;, ex.getMessage()));
                }
            }
        }

    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><h5 id="效果-5"><a href="#效果-5" class="header-anchor">#</a> 效果</h5> <p><img src="/assets/img/image-1024x394.98b01f3c.png" alt=""></p> <p>只要解析出hikariDataSource然后分别绑定进去，可以分别获取到监控数据了。</p> <p>在测试的时候发现dynamicRoutingDataSource获取到的都是ItemDataSource而不是DataSource，若没有强制转换直接DataSourceUnwrapper.unwrap还是为null的状态</p> <p>再次访问/actuator/prometheus，即可看到出现了设置的2个数据源连接池的监控数据</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>页面</p> <p><img src="/assets/img/image-4-1024x318.0ebcf016.png" alt=""></p> <h3 id="参考博客原文"><a href="#参考博客原文" class="header-anchor">#</a> 参考博客原文</h3> <p>SpringBoot2.X版本后使用Hikari作为数据库的默认的连接池。</p> <p>Spring.datasource的默认配置中使用了自动配置的方式来绑定MetricsRegistry,</p> <p>在spring-boot-actuator-autoconfigure包中org.springframework.boot.actuate.autoconfigure.metrics.jdbc.DataSourcePoolMetricsAutoConfiguration类中默认包含了有关于HikariDataSoucre的Metrics监控的绑定逻辑</p> <p><img src="/assets/img/2020081414024634.c4b3a8bf.png" alt=""></p> <p>而HikariCP也提供了有关使用Prometheus监控的具体实现</p> <p><img src="/assets/img/20200814135902116.2f859b94.png" alt=""></p> <p>当使用使用spring.datasource的基本配置时，springboot的自动配置和hikari中的监控逻辑二者结合后，有关prometheus的metrice监控数据就会呈现出来</p> <p>application.properties中配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>application.properties中配置
 
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    type: com.zaxxer.hikari.HikariDataSource
    url: ${url}
    username: ${username}
    password: ${password}
    hikari:
      pool-name: HikariPool-1        
      minimum-idle: 10           
      maximum-pool-size: 20      
      idle-timeout: 500000        
      max-lifetime: 540000        
      connection-timeout: 60000   
      connection-test-query: SELECT 1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>当我们开启了prometheus的端点监控后http://IP:PORT/actuator/prometheus便可以查看到关于hikaricp相关的监控数据，同时利用prometheus实时抓取监控数据用于图标呈现</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># HELP hikaricp_connections_max Max connections
# TYPE hikaricp_connections_max gauge
hikaricp_connections_max{pool=&quot;HikariPool-1&quot;,} 50.0
# HELP hikaricp_connections_pending Pending threads
# TYPE hikaricp_connections_pending gauge
hikaricp_connections_pending{pool=&quot;HikariPool-1&quot;,} 0.0
# HELP hikaricp_connections_timeout_total Connection timeout total count
# TYPE hikaricp_connections_timeout_total counter
hikaricp_connections_timeout_total{pool=&quot;HikariPool-1&quot;,} 0.0
# HELP hikaricp_connections_acquire_seconds Connection acquire time
# TYPE hikaricp_connections_acquire_seconds summary
hikaricp_connections_acquire_seconds_count{pool=&quot;HikariPool-1&quot;,} 1.0
hikaricp_connections_acquire_seconds_sum{pool=&quot;HikariPool-1&quot;,} 7.39E-5
# HELP hikaricp_connections_acquire_seconds_max Connection acquire time
# TYPE hikaricp_connections_acquire_seconds_max gauge
hikaricp_connections_acquire_seconds_max{pool=&quot;HikariPool-1&quot;,} 7.39E-5
# HELP hikaricp_connections_min Min connections
# TYPE hikaricp_connections_min gauge
hikaricp_connections_min{pool=&quot;HikariPool-1&quot;,} 3.0
# HELP hikaricp_connections_usage_seconds Connection usage time
# TYPE hikaricp_connections_usage_seconds summary
hikaricp_connections_usage_seconds_count{pool=&quot;HikariPool-1&quot;,} 1.0
hikaricp_connections_usage_seconds_sum{pool=&quot;HikariPool-1&quot;,} 0.025
# HELP hikaricp_connections_usage_seconds_max Connection usage time
# TYPE hikaricp_connections_usage_seconds_max gauge
hikaricp_connections_usage_seconds_max{pool=&quot;HikariPool-1&quot;,} 0.025
# HELP hikaricp_connections_creation_seconds_max Connection creation time
# TYPE hikaricp_connections_creation_seconds_max gauge
hikaricp_connections_creation_seconds_max{pool=&quot;HikariPool-1&quot;,} 0.094
# HELP hikaricp_connections_creation_seconds Connection creation time
# TYPE hikaricp_connections_creation_seconds summary
hikaricp_connections_creation_seconds_count{pool=&quot;HikariPool-1&quot;,} 2.0
hikaricp_connections_creation_seconds_sum{pool=&quot;HikariPool-1&quot;,} 0.178
# HELP hikaricp_connections_active Active connections
# TYPE hikaricp_connections_active gauge
hikaricp_connections_active{pool=&quot;HikariPool-1&quot;,} 0.0
# HELP hikaricp_connections Total connections
# TYPE hikaricp_connections gauge
hikaricp_connections{pool=&quot;HikariPool-1&quot;,} 3.0
# HELP hikaricp_connections_idle Idle connections
# TYPE hikaricp_connections_idle gauge
hikaricp_connections_idle{pool=&quot;HikariPool-1&quot;,} 3.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>但是，当我们使用了ShardingSphere作为分库分表中间件来使用以后，因为由于自动配置中使用的DataSource由HikariDataSource变为了ShardingDataSource，所以无法完成对HikariMetricsRegistry的绑定操作，因此使用了Sharding后无法再从/actuator/prometheus中看到关于hikaricp有关的数据。</p> <p><img src="/assets/img/20200814142605923.b350c2b8.png" alt=""></p> <p>那么如何解决这个问题呢，我们可以模仿这个DataSourcePoolMetricsAutoConfiguration的逻辑，为Sharding内的dataSources进行循环绑定。</p> <p>我们知道，Sharding的自动配置逻辑中，org.apache.shardingsphere.shardingjdbc.spring.boot.SpringBootConfiguration，将Sharding配置的多数据库连接放到了一个dataSourceMap中。因此我们绑定MetricsRegistry时也就是需要获取Sharing中的dataSourceMap中的数据来分别注册。通常我们会如下配置shardingsphere定义2个数据源.</p> <p>application.properties中配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>application.properties中配置
 
spring:
  shardingsphere:
    datasource:
      names: ds0, ds1
      ds0:
        type: com.zaxxer.hikari.HikariDataSource
        driver-class-name: com.mysql.cj.jdbc.Driver
        jdbcUrl: ${url}
        username: ${username}
        password: ${password}
        pool-name: HikariPool-1        
        minimum-idle: 10            
        maximum-pool-size: 20       
        idle-timeout: 500000       
        max-lifetime: 540000    
        connection-timeout: 60000  
        connection-test-query: SELECT 1
      ds1:
        type: com.zaxxer.hikari.HikariDataSource
        driver-class-name: com.mysql.cj.jdbc.Driver
        jdbcUrl: ${url}
        username: ${username}
        password: ${password}
        pool-name: HikariPool-2      
        minimum-idle: 10           
        maximum-pool-size: 20      
        idle-timeout: 500000      
        max-lifetime: 540000      
        connection-timeout: 60000 
        connection-test-query: SELECT 1        
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>同时我们模仿DataSourceMetricsConfiguration，编写一个ShardingDataSourceMetricsConfiguration，源码如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.Collection;
 
import javax.sql.DataSource;
 
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.shardingsphere.shardingjdbc.jdbc.core.datasource.ShardingDataSource;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.actuate.autoconfigure.metrics.MetricsAutoConfiguration;
import org.springframework.boot.actuate.autoconfigure.metrics.export.simple.SimpleMetricsExportAutoConfiguration;
import org.springframework.boot.autoconfigure.AutoConfigureAfter;
import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;
import org.springframework.boot.jdbc.DataSourceUnwrapper;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.log.LogMessage;
 
import com.zaxxer.hikari.HikariDataSource;
import com.zaxxer.hikari.metrics.micrometer.MicrometerMetricsTrackerFactory;
 
import io.micrometer.core.instrument.MeterRegistry;
 
@Configuration(proxyBeanMethods = false)
@AutoConfigureAfter({ MetricsAutoConfiguration.class, DataSourceAutoConfiguration.class,
        SimpleMetricsExportAutoConfiguration.class })
@ConditionalOnClass({ DataSource.class, MeterRegistry.class })
@ConditionalOnBean({ DataSource.class, MeterRegistry.class })
public class ShardingDataSourcePoolMetricsAutoConfiguration {
 
    @Configuration(proxyBeanMethods = false)
    @ConditionalOnClass({ShardingDataSource.class, HikariDataSource.class})
    static class ShardingDataSourceMetricsConfiguration {
 
        private static final Log logger = LogFactory.getLog(ShardingDataSourceMetricsConfiguration.class);
 
        private final MeterRegistry registry;
 
        ShardingDataSourceMetricsConfiguration(MeterRegistry registry) {
            this.registry = registry;
        }
 
        @Autowired
        void bindMetricsRegistryToHikariDataSources(Collection&lt;DataSource&gt; dataSources) {
            for (DataSource dataSource : dataSources) {
                ShardingDataSource shardingDataSource = DataSourceUnwrapper.unwrap(dataSource, ShardingDataSource.class);
                Collection&lt;DataSource&gt; shardDataSources = shardingDataSource.getDataSourceMap().values();
                for (DataSource ds : shardDataSources) {
                    HikariDataSource hikariDataSource = DataSourceUnwrapper.unwrap(ds, HikariDataSource.class);
                    if (hikariDataSource != null) {
                        bindMetricsRegistryToHikariDataSource(hikariDataSource);
                    }
                }
            }
        }
 
        private void bindMetricsRegistryToHikariDataSource(HikariDataSource hikari) {
            if (hikari.getMetricRegistry() == null &amp;&amp; hikari.getMetricsTrackerFactory() == null) {
                try {
                    hikari.setMetricsTrackerFactory(new MicrometerMetricsTrackerFactory(this.registry));
                }
                catch (Exception ex) {
                    logger.warn(LogMessage.format(&quot;Failed to bind Hikari metrics: %s&quot;, ex.getMessage()));
                }
            }
        }
 
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><p>重点就是在这里，我们知道ShardingDataSource中包含了具体数据源连接池，只要解析出hikariDataSource然后分别绑定进去，可以分别获取到监控数据了。</p> <p>当我们再次访问http://IP:PORT/actuator/prometheus，我们就可以看到出现了设置的2个数据源连接池的监控数据。</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>附带指标监控解释</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>指标1：hikaricp_pending_threads
hikaricp_pending_threads 表示当前排队获取连接的线程数，Guage类型。该指标持续飙高，说明DB连接池中基本已无空闲连接。
指标2：hikaricp_connection_acquired_nanos
hikaricp_connection_acquired_nanos表示连接获取的等待时间，一般取99位数，Summary类型
指标3：hikaricp_idle_connections
hikaricp_idle_connections表示当前空闲连接数，Gauge类型。HikariCP是可以配置最小空闲连接数的，当此指标长期比较高（等于最大连接数）时，可以适当减小配置项中最小连接数。
指标4：hikaricp_active_connections
hikaricp_active_connections表示当前正在使用的连接数，Gauge类型。如果此指标长期在设置的最大连接数上下波动时，或者长期保持在最大线程数时，可以考虑增大最大连接数。
指标5：hikaricp_connection_usage_millis
hikaricp_connection_usage_millis表示连接被复用的间隔时长，一般取99位数，Summary类型。该配置的意义在于表明连接池中的一个连接从被返回连接池到再被复用的时间间隔，对于使用较少的数据源，此指标可能会达到秒级，可以结合流量高峰期的此项指标与激活连接数指标来确定是否需要减小最小连接数，若高峰也是秒级，说明对比数据源使用不频繁，可考虑减小连接数。
指标6：hikaricp_connection_timeout_total
hikaricp_connection_timeout_total表示每分钟超时连接数，Counter类型。主要用来反映连接池中总共超时的连接数量，此处的超时指的是连接创建超时。经常连接创建超时，一个排查方向是和运维配合检查下网络是否正常。
指标7：hikaricp_connection_creation_millis
hikaricp_connection_creation_millis表示连接创建成功的耗时，一般取99位数，Summary类型。该配置的意义在于表明创建一个连接的耗时，主要反映当前机器到数据库的网络情况，在IDC意义不大，除非是网络抖动或者机房间通讯中断才会有异常波动。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="完整部署包"><a href="#完整部署包" class="header-anchor">#</a> 完整部署包</h2> <p>地址</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>链接：https://pan.baidu.com/s/1U6tASaxXWXq3B1hBjOg1XA 
提取码：2v0q 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="修改时区"><a href="#修改时区" class="header-anchor">#</a> 修改时区</h2> <h3 id="prometheus"><a href="#prometheus" class="header-anchor">#</a> prometheus</h3> <p>使用以下Dockerfile生成的镜像，目录结构</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>./
├── dockerfile
└── prometheus-2.26.0.linux-amd64.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Dockerfile</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>FROM centos:7

ADD prometheus-2.26.0.linux-amd64.tar.gz /

RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; \
    mv /prometheus-2.26.0.linux-amd64 /prometheus

WORKDIR /prometheus
ENTRYPOINT [ &quot;/prometheus/prometheus&quot; ]
CMD        [ &quot;--config.file=/etc/prometheus/prometheus.yml&quot;, \
             &quot;--storage.tsdb.path=/prometheus&quot;, \
             &quot;--web.console.libraries=/usr/share/prometheus/console_libraries&quot;, \
             &quot;--web.console.templates=/usr/share/prometheus/consoles&quot; ]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>文件地址</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>链接：https://pan.baidu.com/s/19AOpkjEejplz7agsBR0gKg 
提取码：x05e 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>构建：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker build -t prometheus\_sh:v2.26.0 ./
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="新增对docker监控"><a href="#新增对docker监控" class="header-anchor">#</a> 新增对Docker监控</h2> <h3 id="启动cadvisor"><a href="#启动cadvisor" class="header-anchor">#</a> 启动cadvisor</h3> <p>新增或修改docker-compose.yml，启动cadvisor服务</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.7'

services:
  cadvisor:
    image: google/cadvisor:v0.33.0
    container_name: cadvisor
    restart: unless-stopped
    ports:
      - &quot;8080:8080&quot;
    volumes:
      - &quot;/:/rootfs:ro&quot;
      - &quot;/var/run:/var/run:rw&quot;
      - &quot;/sys:/sys:ro&quot;
      - &quot;/var/lib/docker/:/var/lib/docker:ro&quot;
      - &quot;/dev/disk/:/dev/disk:ro&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>修改prometheus.yml，增加job</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  - job_name: 'cadvisor'
    static_configs:
    - targets: ['172.18.194.139:8080']
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/assets/img/image-2.0ee608fc.png" alt=""></p> <p>修改完成后重启监控系统</p> <h3 id="引入面板-5"><a href="#引入面板-5" class="header-anchor">#</a> 引入面板</h3> <p>893或179</p> <p><img src="/assets/img/image-3-1024x758.a7a5c6fd.png" alt=""></p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/03/14, 05:49:29</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/3c702b/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">SkyWalking部署及使用</div></a> <a href="/pages/d23db1/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">K8S-CICD</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/3c702b/" class="prev">SkyWalking部署及使用</a></span> <span class="next"><a href="/pages/d23db1/">K8S-CICD</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer">
     Copyright © 2019-2024
    <span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a4313708.js" defer></script><script src="/assets/js/4.c82850c7.js" defer></script><script src="/assets/js/6.977c7f70.js" defer></script><script src="/assets/js/5.778263a8.js" defer></script>
  </body>
</html>
