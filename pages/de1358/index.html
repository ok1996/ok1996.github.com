<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>K3S-CICD | 北山小库</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/20230310/logo.3mn8xlqm9oy0.webp">
    <meta name="description" content="小渔村的板砖师傅">
    <meta name="keywords" content="小渔村的板砖师傅">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.b5b3c98c.css" as="style"><link rel="preload" href="/assets/js/app.f4baf4ac.js" as="script"><link rel="preload" href="/assets/js/4.fb059a0d.js" as="script"><link rel="preload" href="/assets/js/6.0568657e.js" as="script"><link rel="preload" href="/assets/js/2.24e37fe1.js" as="script"><link rel="prefetch" href="/assets/js/10.257b0ff7.js"><link rel="prefetch" href="/assets/js/100.0cbe4b1e.js"><link rel="prefetch" href="/assets/js/101.c4113386.js"><link rel="prefetch" href="/assets/js/102.6cb03a8e.js"><link rel="prefetch" href="/assets/js/103.e50e3e2d.js"><link rel="prefetch" href="/assets/js/104.41c3a6cd.js"><link rel="prefetch" href="/assets/js/105.ad7544ed.js"><link rel="prefetch" href="/assets/js/106.a2e5e79e.js"><link rel="prefetch" href="/assets/js/107.598aabbf.js"><link rel="prefetch" href="/assets/js/108.41e220f1.js"><link rel="prefetch" href="/assets/js/109.a59e15cf.js"><link rel="prefetch" href="/assets/js/11.a5c49a7f.js"><link rel="prefetch" href="/assets/js/110.b8e0466a.js"><link rel="prefetch" href="/assets/js/12.da032339.js"><link rel="prefetch" href="/assets/js/13.00f5e4eb.js"><link rel="prefetch" href="/assets/js/14.bdeb8564.js"><link rel="prefetch" href="/assets/js/15.e7c6f254.js"><link rel="prefetch" href="/assets/js/16.d6bccf7c.js"><link rel="prefetch" href="/assets/js/17.f062dcfc.js"><link rel="prefetch" href="/assets/js/18.a35f48c2.js"><link rel="prefetch" href="/assets/js/19.4988682b.js"><link rel="prefetch" href="/assets/js/20.18ede69b.js"><link rel="prefetch" href="/assets/js/21.cfd19cd5.js"><link rel="prefetch" href="/assets/js/22.34eea813.js"><link rel="prefetch" href="/assets/js/23.87b242e8.js"><link rel="prefetch" href="/assets/js/24.3682ae84.js"><link rel="prefetch" href="/assets/js/25.1fa2cc2c.js"><link rel="prefetch" href="/assets/js/26.ed8f7b91.js"><link rel="prefetch" href="/assets/js/27.ce3a9e28.js"><link rel="prefetch" href="/assets/js/28.46ba6e3a.js"><link rel="prefetch" href="/assets/js/29.c287178d.js"><link rel="prefetch" href="/assets/js/3.60095f76.js"><link rel="prefetch" href="/assets/js/30.b6d5b4df.js"><link rel="prefetch" href="/assets/js/31.eb96d110.js"><link rel="prefetch" href="/assets/js/32.11602ae2.js"><link rel="prefetch" href="/assets/js/33.79e63f7b.js"><link rel="prefetch" href="/assets/js/34.1b572115.js"><link rel="prefetch" href="/assets/js/35.cdd9e9c3.js"><link rel="prefetch" href="/assets/js/36.9922968f.js"><link rel="prefetch" href="/assets/js/37.53342d50.js"><link rel="prefetch" href="/assets/js/38.1dc35e93.js"><link rel="prefetch" href="/assets/js/39.2154c7ba.js"><link rel="prefetch" href="/assets/js/40.6e5d241c.js"><link rel="prefetch" href="/assets/js/41.703bd572.js"><link rel="prefetch" href="/assets/js/42.faa43937.js"><link rel="prefetch" href="/assets/js/43.b08c165b.js"><link rel="prefetch" href="/assets/js/44.94f2ce94.js"><link rel="prefetch" href="/assets/js/45.b0a38f10.js"><link rel="prefetch" href="/assets/js/46.a6d52475.js"><link rel="prefetch" href="/assets/js/47.65e87768.js"><link rel="prefetch" href="/assets/js/48.621c5e53.js"><link rel="prefetch" href="/assets/js/49.000fb15d.js"><link rel="prefetch" href="/assets/js/5.2b0f0edf.js"><link rel="prefetch" href="/assets/js/50.2dca5c67.js"><link rel="prefetch" href="/assets/js/51.ad1e8aba.js"><link rel="prefetch" href="/assets/js/52.8f1ec809.js"><link rel="prefetch" href="/assets/js/53.3d8673b6.js"><link rel="prefetch" href="/assets/js/54.5635b50d.js"><link rel="prefetch" href="/assets/js/55.02810ddf.js"><link rel="prefetch" href="/assets/js/56.fad3fa66.js"><link rel="prefetch" href="/assets/js/57.961fcb2c.js"><link rel="prefetch" href="/assets/js/58.74e15bda.js"><link rel="prefetch" href="/assets/js/59.2d7a6c6a.js"><link rel="prefetch" href="/assets/js/60.bc79a19b.js"><link rel="prefetch" href="/assets/js/61.2d5259c5.js"><link rel="prefetch" href="/assets/js/62.76b690af.js"><link rel="prefetch" href="/assets/js/63.4c188611.js"><link rel="prefetch" href="/assets/js/64.6d52f5ac.js"><link rel="prefetch" href="/assets/js/65.19c55625.js"><link rel="prefetch" href="/assets/js/66.2f8eb763.js"><link rel="prefetch" href="/assets/js/67.16a70b62.js"><link rel="prefetch" href="/assets/js/68.162203fb.js"><link rel="prefetch" href="/assets/js/69.8757d2a7.js"><link rel="prefetch" href="/assets/js/7.22f9576e.js"><link rel="prefetch" href="/assets/js/70.6c4fdbbc.js"><link rel="prefetch" href="/assets/js/71.54b8cf03.js"><link rel="prefetch" href="/assets/js/72.8624b1eb.js"><link rel="prefetch" href="/assets/js/73.95e81c38.js"><link rel="prefetch" href="/assets/js/74.f4664c35.js"><link rel="prefetch" href="/assets/js/75.88b2bf83.js"><link rel="prefetch" href="/assets/js/76.a0d4122a.js"><link rel="prefetch" href="/assets/js/77.c7c52928.js"><link rel="prefetch" href="/assets/js/78.e7680bd9.js"><link rel="prefetch" href="/assets/js/79.d73514bd.js"><link rel="prefetch" href="/assets/js/8.9b470bc5.js"><link rel="prefetch" href="/assets/js/80.37b9fabd.js"><link rel="prefetch" href="/assets/js/81.ebc59a84.js"><link rel="prefetch" href="/assets/js/82.01f6a51d.js"><link rel="prefetch" href="/assets/js/83.dd26c89f.js"><link rel="prefetch" href="/assets/js/84.9eb65807.js"><link rel="prefetch" href="/assets/js/85.b24e0a7d.js"><link rel="prefetch" href="/assets/js/86.2922b887.js"><link rel="prefetch" href="/assets/js/87.cc6c6739.js"><link rel="prefetch" href="/assets/js/88.08f969dc.js"><link rel="prefetch" href="/assets/js/89.b0adb197.js"><link rel="prefetch" href="/assets/js/9.39febaeb.js"><link rel="prefetch" href="/assets/js/90.c8b286a0.js"><link rel="prefetch" href="/assets/js/91.df3d3319.js"><link rel="prefetch" href="/assets/js/92.9928d4c4.js"><link rel="prefetch" href="/assets/js/93.f201c207.js"><link rel="prefetch" href="/assets/js/94.e698d383.js"><link rel="prefetch" href="/assets/js/95.912652fd.js"><link rel="prefetch" href="/assets/js/96.352c8a68.js"><link rel="prefetch" href="/assets/js/97.8750daa6.js"><link rel="prefetch" href="/assets/js/98.fd3be9dd.js"><link rel="prefetch" href="/assets/js/99.50b9fc60.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b5b3c98c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><!----> <span class="title" style="display:;">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p24110/" class="nav-link">2024.1.1.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p24111/" class="nav-link">2024.1.1.1</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p24120/" class="nav-link">2024.1.2.0</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分类" class="dropdown-title"><!----> <span class="title" style="display:;">技术分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/note/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/note/deploy/" class="nav-link">Deploy</a></li><li class="dropdown-item"><!----> <a href="/note/application/" class="nav-link">Application</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友情链接</a></div> <a href="https://github.com/ok1996" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/20230310/logo.3mn8xlqm9oy0.webp"> <div class="blogger-info"><h3>Xiao ku</h3> <span>板砖师傅</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><!----> <span class="title" style="display:;">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p24110/" class="nav-link">2024.1.1.0</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p24111/" class="nav-link">2024.1.1.1</a></li><li class="dropdown-item"><!----> <a href="/pages/8e9dc3p24120/" class="nav-link">2024.1.2.0</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分类" class="dropdown-title"><!----> <span class="title" style="display:;">技术分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/note/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/note/deploy/" class="nav-link">Deploy</a></li><li class="dropdown-item"><!----> <a href="/note/application/" class="nav-link">Application</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友情链接</a></div> <a href="https://github.com/ok1996" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/74ea91/" class="sidebar-link">Docker一键部署</a></li><li><a href="/pages/d04772/" class="sidebar-link">Mysql主从配置一键化</a></li><li><a href="/pages/b6e922/" class="sidebar-link">Mysql新建主从同步-mysqldump</a></li><li><a href="/pages/3c702b/" class="sidebar-link">SkyWalking部署及使用</a></li><li><a href="/pages/bb3405/" class="sidebar-link">Prometheus部署及使用</a></li><li><a href="/pages/d23db1/" class="sidebar-link">K8S-CICD</a></li><li><a href="/pages/c5c5bb/" class="sidebar-link">K8S-在线安装</a></li><li><a href="/pages/04f4f5/" class="sidebar-link">K3S-在线安装</a></li><li><a href="/pages/de1358/" aria-current="page" class="active sidebar-link">K3S-CICD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/de1358/#初始化准备-all-of-server" class="sidebar-link">初始化准备（ALL of SERVER）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#设置各个主机名称" class="sidebar-link">设置各个主机名称</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#部署docker-all-of-server" class="sidebar-link">部署Docker（ALL of SERVER）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#上传附件" class="sidebar-link">上传附件</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#解压赋权并安装" class="sidebar-link">解压赋权并安装</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#安装完成" class="sidebar-link">安装完成</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#关闭防火墙-all-of-server" class="sidebar-link">关闭防火墙（ALL of SERVER）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#关闭防火墙" class="sidebar-link">关闭防火墙</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#重启docker" class="sidebar-link">重启Docker</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#部署harbor-222" class="sidebar-link">部署Harbor（222）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#上传附件-2" class="sidebar-link">上传附件</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#解压" class="sidebar-link">解压</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#新建文件harbor-yml" class="sidebar-link">新建文件harbor.yml</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#安装完成验证" class="sidebar-link">安装完成验证</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#docker配置harbor-all-of-server" class="sidebar-link">Docker配置Harbor（ALL of SERVER）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#配置daemon-json" class="sidebar-link">配置daemon.json</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#注意" class="sidebar-link">注意</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#登录docker" class="sidebar-link">登录docker</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#部署mysql-221" class="sidebar-link">部署Mysql（221）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#编排文件并启动" class="sidebar-link">编排文件并启动</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#创建k3s数据库" class="sidebar-link">创建K3S数据库</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#部署k3s集群-201-213" class="sidebar-link">部署K3S集群(201\~213)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#部署master-201" class="sidebar-link">部署Master（201）</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#部署" class="sidebar-link">部署</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#查看token" class="sidebar-link">查看Token</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#部署slave-202-203" class="sidebar-link">部署Slave（202~203）</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#部署-202-203" class="sidebar-link">部署（202~203）</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#设置202和203-slave角色-201" class="sidebar-link">设置202和203 Slave角色（201）</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#部署master-211" class="sidebar-link">部署Master（211）</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#部署-2" class="sidebar-link">部署</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#部署slave-212-213" class="sidebar-link">部署Slave（212~213）</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#部署-212-213" class="sidebar-link">部署（212~213）</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#设置212和213-slave角色-211" class="sidebar-link">设置212和213 Slave角色（211）</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#完成部署" class="sidebar-link">完成部署</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#注" class="sidebar-link">注</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#卸载" class="sidebar-link">卸载</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#查看状态" class="sidebar-link">查看状态</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#查看节点" class="sidebar-link">查看节点</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#查看版本" class="sidebar-link">查看版本</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#部署rancher-221" class="sidebar-link">部署Rancher（221）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#申请下载证书" class="sidebar-link">申请下载证书</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#编排文件并启动-2" class="sidebar-link">编排文件并启动</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#配置rancher集群" class="sidebar-link">配置Rancher集群</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#浏览器访问证书申请域名地址" class="sidebar-link">浏览器访问证书申请域名地址</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#根据提示查找密码" class="sidebar-link">根据提示查找密码</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#输入新密码" class="sidebar-link">输入新密码</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#设置中文" class="sidebar-link">设置中文</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#导入集群" class="sidebar-link">导入集群</a></li><li class="sidebar-sub-header level5"><a href="/pages/de1358/#点击导入已有集群" class="sidebar-link">点击导入已有集群</a></li><li class="sidebar-sub-header level5"><a href="/pages/de1358/#点击通用" class="sidebar-link">点击通用</a></li><li class="sidebar-sub-header level5"><a href="/pages/de1358/#输入集群名称-点击创建" class="sidebar-link">输入集群名称，点击创建</a></li><li class="sidebar-sub-header level5"><a href="/pages/de1358/#复制命令" class="sidebar-link">复制命令</a></li><li class="sidebar-sub-header level5"><a href="/pages/de1358/#k3s集群master201服务器上执行" class="sidebar-link">K3s集群Master201服务器上执行</a></li><li class="sidebar-sub-header level5"><a href="/pages/de1358/#刷新rancher首页" class="sidebar-link">刷新rancher首页</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#若需更新证书" class="sidebar-link">若需更新证书</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#部署nfs-all-of-server" class="sidebar-link">部署NFS（ALL of SERVER）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#安装命令" class="sidebar-link">安装命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#服务端配置-221" class="sidebar-link">服务端配置（221）</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#创建共享文件夹" class="sidebar-link">创建共享文件夹</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#nfs配置" class="sidebar-link">NFS配置</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#客户端测试-201" class="sidebar-link">客户端测试（201）</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#创建共享文件夹-2" class="sidebar-link">创建共享文件夹</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#挂载测试" class="sidebar-link">挂载测试</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#查看挂载情况" class="sidebar-link">查看挂载情况</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#卸载-2" class="sidebar-link">卸载</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#部署gitlab-222" class="sidebar-link">部署Gitlab（222）</a></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#部署gitlab-方式二" class="sidebar-link">部署Gitlab（方式二）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#创建项目" class="sidebar-link">创建项目</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#创建命名空间" class="sidebar-link">创建命名空间</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#创建工作负载" class="sidebar-link">创建工作负载</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#containers" class="sidebar-link">Containers</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#存储挂载nfs" class="sidebar-link">存储挂载NFS</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#点击创建完成启动" class="sidebar-link">点击创建完成启动</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#服务发现" class="sidebar-link">服务发现</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#浏览器访问" class="sidebar-link">浏览器访问</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#登录密码-221" class="sidebar-link">登录密码（221）</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#部署jenkins-222" class="sidebar-link">部署Jenkins（222）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#制作镜像" class="sidebar-link">制作镜像</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#构建镜像" class="sidebar-link">构建镜像</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#生成镜像" class="sidebar-link">生成镜像</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#创建启动" class="sidebar-link">创建启动</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#浏览器访问-2" class="sidebar-link">浏览器访问</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#登录密码" class="sidebar-link">登录密码</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#初始化jenkins" class="sidebar-link">初始化Jenkins</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#初始化" class="sidebar-link">初始化</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#查看java和maven安装地址" class="sidebar-link">查看java和maven安装地址</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#配置jdk" class="sidebar-link">配置JDK</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#配置maven" class="sidebar-link">配置Maven</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#自定义安装插件" class="sidebar-link">自定义安装插件</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#测试jenkins" class="sidebar-link">测试Jenkins</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#测试-docker-maven" class="sidebar-link">测试(docker-maven)</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#创建流水线任务" class="sidebar-link">创建流水线任务</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#pipeline脚本" class="sidebar-link">pipeline脚本</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#构建触发器-关联gitlab" class="sidebar-link">构建触发器（关联Gitlab）</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#立即构建" class="sidebar-link">立即构建</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#初始化harbor" class="sidebar-link">初始化Harbor</a></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#初始化gitlab" class="sidebar-link">初始化Gitlab</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#登录" class="sidebar-link">登录</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#创建用户" class="sidebar-link">创建用户</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#创建用户-2" class="sidebar-link">创建用户</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#初始化密码" class="sidebar-link">初始化密码</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#初始化项目-root权限" class="sidebar-link">初始化项目(root权限)</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#创建组" class="sidebar-link">创建组</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#创建空项目" class="sidebar-link">创建空项目</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#创建dev分支" class="sidebar-link">创建dev分支</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#提交项目代码" class="sidebar-link">提交项目代码</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#赋权账号" class="sidebar-link">赋权账号</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#设置jenkins-用户ssh秘钥" class="sidebar-link">设置jenkins 用户ssh秘钥</a></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#获取access-tokens" class="sidebar-link">获取Access Tokens</a></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#jenkins配置git-gitlab" class="sidebar-link">Jenkins配置Git/GitLab</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#jenkins配置gitlab" class="sidebar-link">Jenkins配置GitLab</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#jenkins配置git" class="sidebar-link">Jenkins配置Git</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#创建jenkins-job-gitlab" class="sidebar-link">创建Jenkins-job(gitlab)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#新建item-ok-springboot-imdemo" class="sidebar-link">新建Item：ok-springboot-imdemo</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#配置-2" class="sidebar-link">配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#流水线" class="sidebar-link">流水线</a></li><li class="sidebar-sub-header level4"><a href="/pages/de1358/#构建触发器" class="sidebar-link">构建触发器</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#rancher创建密文-harbor-k3s" class="sidebar-link">Rancher创建密文-Harbor（K3S）</a></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#rancher更新镜像构建" class="sidebar-link">Rancher更新镜像构建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#下载cli" class="sidebar-link">下载CLI</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#下载kubectl" class="sidebar-link">下载kubectl</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#构建镜像并上传" class="sidebar-link">构建镜像并上传</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#jenkins构建微服务镜像" class="sidebar-link">Jenkins构建微服务镜像</a></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#rancher创建微服务" class="sidebar-link">Rancher创建微服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#创建项目-2" class="sidebar-link">创建项目</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#创建命名空间-2" class="sidebar-link">创建命名空间</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#创建负载" class="sidebar-link">创建负载</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#gitlab触发jenkins" class="sidebar-link">Gitlab触发Jenkins</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#gitlab取消限制策略" class="sidebar-link">Gitlab取消限制策略</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#jenkins取消限制策略" class="sidebar-link">Jenkins取消限制策略</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#配置触发" class="sidebar-link">配置触发</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/de1358/#触发rancher更新镜像" class="sidebar-link">触发Rancher更新镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/de1358/#创建api密钥" class="sidebar-link">创建API密钥</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#复制持有者令牌" class="sidebar-link">复制持有者令牌</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#复制api地址" class="sidebar-link">复制API地址</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#复制项目project-id" class="sidebar-link">复制项目PROJECT ID</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#复制项目containername" class="sidebar-link">复制项目ContainerName</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#更新镜像命令说明" class="sidebar-link">更新镜像命令说明</a></li><li class="sidebar-sub-header level3"><a href="/pages/de1358/#更新镜像容器命令示例" class="sidebar-link">更新镜像容器命令示例</a></li></ul></li></ul></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/note/deploy/#Deploy" data-v-06970110>Deploy</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/ok1996" target="_blank" title="作者" class="beLink" data-v-06970110>xiaoku</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2023-03-14</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">K3S-CICD<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="集群规划"><a href="#集群规划" class="header-anchor">#</a> 集群规划</h1> <table><thead><tr><th>主机</th> <th>IP</th> <th>内存</th> <th>硬盘</th> <th>应用</th></tr></thead> <tbody><tr><td>master201</td> <td>192.168.213.201</td> <td>8G</td> <td>40G</td> <td>K3S</td></tr> <tr><td>slave202</td> <td>192.168.213.202</td> <td>4G</td> <td>40G</td> <td>K3S</td></tr> <tr><td>slave203</td> <td>192.168.213.203</td> <td>4G</td> <td>40G</td> <td>K3S</td></tr> <tr><td>master211</td> <td>192.168.213.211</td> <td>4G</td> <td>40G</td> <td>K3S</td></tr> <tr><td>slave212</td> <td>192.168.213.212</td> <td>4G</td> <td>40G</td> <td>K3S</td></tr> <tr><td>slave213</td> <td>192.168.213.213</td> <td>4G</td> <td>40G</td> <td>K3S</td></tr> <tr><td>middleware221</td> <td>192.168.213.221</td> <td>4G</td> <td>40G+100G</td> <td>Mysql+NFS+Rancher</td></tr> <tr><td>middleware222</td> <td>192.168.213.222</td> <td>10G</td> <td>40G+100G</td> <td>Harbor+Jenkins+Gitlab</td></tr></tbody></table> <p>图例：</p> <p><img src="/assets/img/image1.2a89a57a.png" alt=""></p> <h1 id="版本"><a href="#版本" class="header-anchor">#</a> 版本</h1> <table><thead><tr><th>组件</th> <th>版本</th> <th>备注</th></tr></thead> <tbody><tr><td>CentOS</td> <td>7.9.2009 (Core)</td> <td>CentOS-7-x86_64-Minimal-2009.iso</td></tr> <tr><td>K3S</td> <td>v1.25.3+k3s1</td> <td>-</td></tr> <tr><td>Mysql</td> <td>5.7.39</td> <td>K3S外部存储</td></tr> <tr><td>Jenkins</td> <td>jenkins:2.377-centos7</td> <td>CI/CD</td></tr> <tr><td>Harbor</td> <td>v2.2.3</td> <td>Docker镜像存储仓库</td></tr> <tr><td>Gitlab</td> <td>gitlab-ce:15.5.4-ce.0</td> <td>Git仓库</td></tr> <tr><td>Rancher</td> <td>2.6.9</td> <td>K3S界面管理</td></tr> <tr><td>Docker</td> <td>20.10.18</td> <td>-</td></tr> <tr><td>Docker Compose</td> <td>v2.10.2</td> <td>-</td></tr></tbody></table> <h1 id="系统信息"><a href="#系统信息" class="header-anchor">#</a> 系统信息</h1> <table><thead><tr><th>系统</th> <th>地址</th> <th>账号</th> <th>密码</th></tr></thead> <tbody><tr><td>Rancher</td> <td>https://rancher.ok96.cn:8443/</td> <td>admin</td> <td>Rancher123456</td></tr> <tr><td>Harbor</td> <td>http://192.168.213.222:22280</td> <td>admin</td> <td>Harbor12345</td></tr> <tr><td>Jenkins</td> <td>http://192.168.213.222:7080</td> <td>admin</td> <td>Admin123</td></tr> <tr><td>Gitlab</td> <td>http://192.168.213.222:8929</td> <td>root</td> <td>gTgBikdfbPhNSzcztYyGfXMauatWUP52HsZbZowmgow=</td></tr> <tr><td>-</td> <td>jenkins</td> <td>Jenkins123</td> <td>-</td></tr> <tr><td>NFS</td> <td>192.168.213.221</td> <td>目录：/data/share</td> <td>-</td></tr></tbody></table> <h1 id="自动构建部署流程图"><a href="#自动构建部署流程图" class="header-anchor">#</a> 自动构建部署流程图</h1> <p><img src="/assets/img/image2.54ccefc9.png" alt=""></p> <h1 id="环境部署步骤"><a href="#环境部署步骤" class="header-anchor">#</a> 环境部署步骤</h1> <h2 id="初始化准备-all-of-server"><a href="#初始化准备-all-of-server" class="header-anchor">#</a> 初始化准备（ALL of SERVER）</h2> <h3 id="设置各个主机名称"><a href="#设置各个主机名称" class="header-anchor">#</a> 设置各个主机名称</h3> <p>在201上执行命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname master201
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在202上执行命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname slave202
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在203上执行命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname slave203
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在211上执行命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname master211
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在212上执行命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname slave212
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在213上执行命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname slave213
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在221上执行命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname middleware221
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在222上执行命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname middleware222
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="部署docker-all-of-server"><a href="#部署docker-all-of-server" class="header-anchor">#</a> 部署Docker（ALL of SERVER）</h2> <h3 id="上传附件"><a href="#上传附件" class="header-anchor">#</a> 上传附件</h3> <p>上传BinaryInstallation.zip压缩包到/data目录下</p> <h3 id="解压赋权并安装"><a href="#解压赋权并安装" class="header-anchor">#</a> 解压赋权并安装</h3> <p>命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>yum install -y unzip
cd /data &amp;&amp; unzip BinaryInstallation.zip
cd /data/BinaryInstallation &amp;&amp; chmod -R 777 docker-init.sh
./docker-init.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="安装完成"><a href="#安装完成" class="header-anchor">#</a> 安装完成</h3> <p><img src="/assets/img/image3.1e6a977e.png" alt=""></p> <h2 id="关闭防火墙-all-of-server"><a href="#关闭防火墙-all-of-server" class="header-anchor">#</a> 关闭防火墙（ALL of SERVER）</h2> <h3 id="关闭防火墙"><a href="#关闭防火墙" class="header-anchor">#</a> 关闭防火墙</h3> <p>执行命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>systemctl stop firewalld
systemctl disable firewalld
setenforce 0
sed -i &quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot; /etc/selinux/config
swapoff -a
yes | cp /etc/fstab /etc/fstab_bak
cat /etc/fstab_bak |grep -v swap &gt; /etc/fstab
sed -i &quot;s#^net.ipv4.ip_forward.*#net.ipv4.ip_forward=1#g&quot;  /etc/sysctl.conf
sed -i &quot;s#^net.bridge.bridge-nf-call-ip6tables.*#net.bridge.bridge-nf-call-ip6tables=1#g&quot;  /etc/sysctl.conf
sed -i &quot;s#^net.bridge.bridge-nf-call-iptables.*#net.bridge.bridge-nf-call-iptables=1#g&quot;  /etc/sysctl.conf
echo &quot;net.ipv4.ip_forward = 1&quot; &gt;&gt; /etc/sysctl.conf
echo &quot;net.bridge.bridge-nf-call-ip6tables = 1&quot; &gt;&gt; /etc/sysctl.conf
echo &quot;net.bridge.bridge-nf-call-iptables = 1&quot; &gt;&gt; /etc/sysctl.conf
sysctl -p
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="重启docker"><a href="#重启docker" class="header-anchor">#</a> 重启Docker</h3> <p>执行命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  systemctl restart docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="部署harbor-222"><a href="#部署harbor-222" class="header-anchor">#</a> 部署Harbor（222）</h2> <h3 id="上传附件-2"><a href="#上传附件-2" class="header-anchor">#</a> 上传附件</h3> <p>上传harbor-offline-installer-v2.2.3.tgz压缩包到/data目录下</p> <h3 id="解压"><a href="#解压" class="header-anchor">#</a> 解压</h3> <p>执行命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd /data
tar xzvf harbor-offline-installer-v2.2.3.tgz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="新建文件harbor-yml"><a href="#新建文件harbor-yml" class="header-anchor">#</a> 新建文件harbor.yml</h3> <p>内容可以参考harbor.yml.tmpl</p> <p>修改 hostname: 192.168.213.222 为本机IP</p> <p>修改 端口</p> <p>修改 数据存储地址/data/harbor/data</p> <p>注释 https</p> <p>命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd /data/harbor
vi harbor.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>输入文本内容</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hostname: 192.168.213.222 

http:
  port: 22280

harbor_admin_password: Harbor12345

database:
  password: root123
  max_idle_conns: 50
  max_open_conns: 1000

data_volume: /data/harbor/data

trivy:
  ignore_unfixed: false
  skip_update: false
  insecure: false

jobservice:
  max_job_workers: 10

notification:
  webhook_job_max_retry: 10

chart:
  absolute_url: disabled

log:
  level: info
  local:
    rotate_count: 50
    rotate_size: 200M
    location: /var/log/harbor
_version: 2.2.0

proxy:
  http_proxy:
  https_proxy:
  no_proxy:
  components:
    - core
    - jobservice
    - trivy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <p>执行命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  sh /data/harbor/install.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="安装完成验证"><a href="#安装完成验证" class="header-anchor">#</a> 安装完成验证</h3> <p>执行命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  docker ps -a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image4.f1e76059.png" alt=""></p> <h2 id="docker配置harbor-all-of-server"><a href="#docker配置harbor-all-of-server" class="header-anchor">#</a> Docker配置Harbor（ALL of SERVER）</h2> <h3 id="配置daemon-json"><a href="#配置daemon-json" class="header-anchor">#</a> 配置daemon.json</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
    &quot;log-driver&quot;:&quot;json-file&quot;,
    &quot;log-opts&quot;:{
        &quot;max-size&quot;:&quot;1000m&quot;,
        &quot;max-file&quot;:&quot;3&quot;
    },
    &quot;insecure-registries&quot;:[
        &quot;192.168.213.222:22280&quot;
    ]
}
EOF

systemctl daemon-reload
systemctl restart docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h3> <p>若是在Harbor部署的服务器（222）执行后，需要重启Harbor，等待系统启动</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd /data/harbor &amp;&amp; docker-compose down &amp;&amp; docker-compose up -d
docker ps -a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="登录docker"><a href="#登录docker" class="header-anchor">#</a> 登录docker</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker login 192.168.213.222:22280
账号：admin
密码：Harbor12345
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="部署mysql-221"><a href="#部署mysql-221" class="header-anchor">#</a> 部署Mysql（221）</h2> <h3 id="编排文件并启动"><a href="#编排文件并启动" class="header-anchor">#</a> 编排文件并启动</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir /data/mysql5-7 &amp;&amp; cd /data/mysql5-7
vi docker-compose.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>输入文件内容</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.1'
services:
  mysql-k3s:
    image: mysql:5.7.39
    restart: always
    container_name: mysql-k3s
    environment:
      MYSQL_ROOT_PASSWORD: xiaoku@mysql2205#
    command:
      --default-authentication-plugin=mysql_native_password
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_general_ci
      --explicit_defaults_for_timestamp=true
      --lower_case_table_names=1
    ports:
      - 2205:3306
    volumes:
      - ./data:/var/lib/mysql
      - ./conf:/etc/mysql/conf.d
      - ./logs:/logs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>启动</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="创建k3s数据库"><a href="#创建k3s数据库" class="header-anchor">#</a> 创建K3S数据库</h3> <p>创建数据库名称为k3s</p> <p><img src="/assets/img/image5.39a630dc.png" alt=""></p> <h2 id="部署k3s集群-201-213"><a href="#部署k3s集群-201-213" class="header-anchor">#</a> 部署K3S集群(201~213)</h2> <h3 id="部署master-201"><a href="#部署master-201" class="header-anchor">#</a> 部署Master（201）</h3> <h4 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>curl -sfL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.25.3+k3s1 sh -s - \
--datastore-endpoint=&quot;mysql://root:xiaoku@mysql2205#@tcp(192.168.213.221:2205)/k3s&quot;  \
--docker \
--write-kubeconfig ~/.kube/config \
--write-kubeconfig-mode 666
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="查看token"><a href="#查看token" class="header-anchor">#</a> 查看Token</h4> <p>命令及返回</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@localhost BinaryInstallation]# cat /var/lib/rancher/k3s/server/node-token
K10bf621cb0bfb8fdbdb87ea0940589b78779b0088c8fdab2a4f5d65ee8d95770bb::server:2a5ed69b7abe52c01a4ab99b5ad836cf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="部署slave-202-203"><a href="#部署slave-202-203" class="header-anchor">#</a> 部署Slave（202~203）</h3> <h4 id="部署-202-203"><a href="#部署-202-203" class="header-anchor">#</a> 部署（202~203）</h4> <p>Token为201返回的数据</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>curl -sfL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.25.3+k3s1 \
K3S_URL=https://192.168.213.201:6443 \
K3S_TOKEN=K10bf621cb0bfb8fdbdb87ea0940589b78779b0088c8fdab2a4f5d65ee8d95770bb::server:2a5ed69b7abe52c01a4ab99b5ad836cf \
sh -s - \
--docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="设置202和203-slave角色-201"><a href="#设置202和203-slave角色-201" class="header-anchor">#</a> 设置202和203 Slave角色（201）</h3> <p>201执行命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  kubectl label node slave202 node-role.kubernetes.io/worker=worker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>  kubectl label node slave203 node-role.kubernetes.io/worker=worker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="部署master-211"><a href="#部署master-211" class="header-anchor">#</a> 部署Master（211）</h3> <h4 id="部署-2"><a href="#部署-2" class="header-anchor">#</a> 部署</h4> <p>token使用201获取的值</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>curl -sfL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.25.3+k3s1 sh -s - server \
--token=K10bf621cb0bfb8fdbdb87ea0940589b78779b0088c8fdab2a4f5d65ee8d95770bb::server:2a5ed69b7abe52c01a4ab99b5ad836cf \
--datastore-endpoint=&quot;mysql://root:xiaoku@mysql2205#@tcp(192.168.213.221:2205)/k3s&quot;  \
--docker \
--write-kubeconfig ~/.kube/config \
--write-kubeconfig-mode 666 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="部署slave-212-213"><a href="#部署slave-212-213" class="header-anchor">#</a> 部署Slave（212~213）</h3> <h4 id="部署-212-213"><a href="#部署-212-213" class="header-anchor">#</a> 部署（212~213）</h4> <p>Token为201返回的数据</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>curl -sfL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.25.3+k3s1 \
K3S_URL=https://192.168.213.211:6443 \
K3S_TOKEN=K10bf621cb0bfb8fdbdb87ea0940589b78779b0088c8fdab2a4f5d65ee8d95770bb::server:2a5ed69b7abe52c01a4ab99b5ad836cf \
sh -s - \
--docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="设置212和213-slave角色-211"><a href="#设置212和213-slave角色-211" class="header-anchor">#</a> 设置212和213 Slave角色（211）</h3> <p>211执行命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  kubectl label node slave212 node-role.kubernetes.io/worker=worker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>  kubectl label node slave213 node-role.kubernetes.io/worker=worker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="完成部署"><a href="#完成部署" class="header-anchor">#</a> 完成部署</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>  k3s kubectl get nodes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="data:image/png;base64,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" alt=""></p> <h3 id="注"><a href="#注" class="header-anchor">#</a> 注</h3> <h4 id="卸载"><a href="#卸载" class="header-anchor">#</a> 卸载</h4> <p>使用安装脚本安装了 K3s，那么在安装过程中会生成一个卸载 K3s 的脚本。</p> <p>卸载 K3s
会删除集群数据和所有脚本。要使用不同的安装选项重新启动集群，请使用不同的标志重新运行安装脚本。</p> <p>要从 server 节点卸载 K3s，请运行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  /usr/local/bin/k3s-uninstall.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>要从 agent 节点卸载 K3s，请运行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  /usr/local/bin/k3s-agent-uninstall.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="查看状态"><a href="#查看状态" class="header-anchor">#</a> 查看状态</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>  systemctl status k3s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>  systemctl status k3s-agent
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="查看节点"><a href="#查看节点" class="header-anchor">#</a> 查看节点</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>  k3s kubectl get nodes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="查看版本"><a href="#查看版本" class="header-anchor">#</a> 查看版本</h4> <p>使用kubectl version
命令，输出的信息会显示client和server的版本信息，client代表kubectl版本信息，server代表的是master节点的k8s版本信息</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@localhost ~]# kubectl version
WARNING: This version information is deprecated and will be replaced with the output from kubectl version --short.  Use --output=yaml|json to get the full version.
Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;25&quot;, GitVersion:&quot;v1.25.0+k3s1&quot;, GitCommit:&quot;26e9405767263a2915723cb72b1ffd7f50687a8f&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2022-09-12T20:11:31Z&quot;, GoVersion:&quot;go1.19&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}
Kustomize Version: v4.5.7
Server Version: version.Info{Major:&quot;1&quot;, Minor:&quot;25&quot;, GitVersion:&quot;v1.25.0+k3s1&quot;, GitCommit:&quot;26e9405767263a2915723cb72b1ffd7f50687a8f&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2022-09-12T20:11:31Z&quot;, GoVersion:&quot;go1.19&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="部署rancher-221"><a href="#部署rancher-221" class="header-anchor">#</a> 部署Rancher（221）</h2> <h3 id="申请下载证书"><a href="#申请下载证书" class="header-anchor">#</a> 申请下载证书</h3> <p>例：阿里云申请完成后，下载Nginx证书</p> <p>上传至221服务器，目录：/data/rancher/certs下</p> <p>文件：</p> <p>rancher.pem 改名cert.pem</p> <p>rancher.key改名key.pem</p> <p>下载根证书 WoSign-RSA-root.crt改名cacerts.pem</p> <h3 id="编排文件并启动-2"><a href="#编排文件并启动-2" class="header-anchor">#</a> 编排文件并启动</h3> <p>编排文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  vi /data/rancher/docker-compose.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>编辑输入</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.1'
services:
  rancher-server:
    image: rancher/rancher:v2.6.9
    restart: unless-stopped
    container_name: rancher-server
    ports:
      - 8082:80
      - 8443:443
    volumes:
      - ./rancher:/var/lib/rancher/
      - ./ssl/cert.pem:/etc/rancher/ssl/cert.pem
      - ./ssl/key.pem:/etc/rancher/ssl/key.pem
      - ./ssl/cacerts.pem:/etc/rancher/ssl/cacerts.pem
    privileged: true
    mem_limit: 2048m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>启动</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  cd /data/rancher &amp;&amp; docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="配置rancher集群"><a href="#配置rancher集群" class="header-anchor">#</a> 配置Rancher集群</h3> <h4 id="浏览器访问证书申请域名地址"><a href="#浏览器访问证书申请域名地址" class="header-anchor">#</a> 浏览器访问证书申请域名地址</h4> <p>例：rancher.ok.cn</p> <p>则：访问https://rancher.ok96.cn:8443/</p> <h4 id="根据提示查找密码"><a href="#根据提示查找密码" class="header-anchor">#</a> 根据提示查找密码</h4> <p><img src="/assets/img/image7.c849f174.png" alt=""></p> <p>命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@localhost rancher]# docker logs  rancher-server  2&gt;&amp;1 | grep &quot;Bootstrap Password:&quot;

2022/09/26 05:45:32 [INFO] Bootstrap Password:
 rdx4fpcg696hkdq6dmfk7sfzlq7cgknv8kfmp9m58k6bchzldd6ndt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="输入新密码"><a href="#输入新密码" class="header-anchor">#</a> 输入新密码</h4> <p>例：密码为 Rancher123456</p> <p><img src="/assets/img/image8.484dc115.png" alt=""></p> <h4 id="设置中文"><a href="#设置中文" class="header-anchor">#</a> 设置中文</h4> <p><img src="/assets/img/image9.a9b44043.png" alt=""></p> <h4 id="导入集群"><a href="#导入集群" class="header-anchor">#</a> 导入集群</h4> <h5 id="点击导入已有集群"><a href="#点击导入已有集群" class="header-anchor">#</a> 点击导入已有集群</h5> <p><img src="/assets/img/image10.79e52fd4.png" alt=""></p> <h5 id="点击通用"><a href="#点击通用" class="header-anchor">#</a> 点击通用</h5> <p><img src="/assets/img/image11.1da4e2c5.png" alt=""></p> <h5 id="输入集群名称-点击创建"><a href="#输入集群名称-点击创建" class="header-anchor">#</a> 输入集群名称，点击创建</h5> <p><img src="/assets/img/image12.12c4a60f.png" alt=""></p> <h5 id="复制命令"><a href="#复制命令" class="header-anchor">#</a> 复制命令</h5> <p>【在运行支持的 Kubernetes 版本的 Kubernetes 集群上，运行以下 kubectl
命令，以将其导入到 Rancher】提示的命令，粘贴到201服务器上执行</p> <p><img src="/assets/img/image13.6005efed.png" alt=""></p> <h5 id="k3s集群master201服务器上执行"><a href="#k3s集群master201服务器上执行" class="header-anchor">#</a> K3s集群Master201服务器上执行</h5> <p><img src="/assets/img/image14.961fb5cc.png" alt=""></p> <h5 id="刷新rancher首页"><a href="#刷新rancher首页" class="header-anchor">#</a> 刷新rancher首页</h5> <p>等待一段时间后，状态为Active</p> <p><img src="/assets/img/image15.3e0d4e1a.png" alt=""></p> <h3 id="若需更新证书"><a href="#若需更新证书" class="header-anchor">#</a> 若需更新证书</h3> <p>新申请下来的证书直接替换</p> <p>目录：/data/rancher/ssl</p> <p>文件：</p> <p>cacerts.pem</p> <p>cert.pem</p> <p>key.pem</p> <p>然后重启即可</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  docker-compose down &amp;&amp; docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="部署nfs-all-of-server"><a href="#部署nfs-all-of-server" class="header-anchor">#</a> 部署NFS（ALL of SERVER）</h2> <h3 id="安装命令"><a href="#安装命令" class="header-anchor">#</a> 安装命令</h3> <p>因为每台K8S都可能需要使用到挂载，故每台都需要执行安装</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>yum -y install nfs-utils  rpcbind 
systemctl enable rpcbind.service
systemctl enable nfs-server.service

systemctl start rpcbind.service
systemctl start nfs-server.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="服务端配置-221"><a href="#服务端配置-221" class="header-anchor">#</a> 服务端配置（221）</h3> <p>服务端IP：192.168.213.221</p> <p>服务点目录：/data/share</p> <h4 id="创建共享文件夹"><a href="#创建共享文件夹" class="header-anchor">#</a> 创建共享文件夹</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>  mkdir -p /data/share
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="nfs配置"><a href="#nfs配置" class="header-anchor">#</a> NFS配置</h4> <p>修改配置文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  vi /etc/exports
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>增加下面这一行数据，指定的ip地址为客户端的地址,地址可以是一个网段（如：192.168.0.0/24）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  /data/share 192.168.213.0/24(rw,no_root_squash,no_all_squash,sync)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>加载配置文件，在相关软件启动后执行</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  exportfs -arv
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="data:image/png;base64,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" alt=""></p> <h3 id="客户端测试-201"><a href="#客户端测试-201" class="header-anchor">#</a> 客户端测试（201）</h3> <h4 id="创建共享文件夹-2"><a href="#创建共享文件夹-2" class="header-anchor">#</a> 创建共享文件夹</h4> <p>命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  mkdir -p /home/nfs_share
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="挂载测试"><a href="#挂载测试" class="header-anchor">#</a> 挂载测试</h4> <p>命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  mount -t nfs 192.168.213.221:/data/share /home/nfs_share

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="查看挂载情况"><a href="#查看挂载情况" class="header-anchor">#</a> 查看挂载情况</h4> <p>命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  df -TH
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="卸载-2"><a href="#卸载-2" class="header-anchor">#</a> 卸载</h4> <p>命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  umount /home/nfs_share
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="部署gitlab-222"><a href="#部署gitlab-222" class="header-anchor">#</a> 部署Gitlab（222）</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir /data/gitlab
cd /data/gitlab&amp;&amp; vi docker-compose.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>输入内容</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3'
services:
  gitlab:
    image: 'gitlab/gitlab-ce:15.5.4-ce.0'
    container_name: gitlab
    restart: always
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url 'http://192.168.213.222:8929' #若有域名可以写域名
        gitlab_rails['gitlab_shell_ssh_port'] = 2224
    ports:
      - '8929:8929'
      - '2224:22'
    volumes:
      #将相关配置映射到当前目录下的config目录
      - './config:/etc/gitlab'
      #将日志映射到当前目录下的logs目录
      - './logs:/var/log/gitlab'
      #将数据映射到当前目录下的data目录
      - './data:/var/opt/gitlab'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>登录账号：root</p> <p>登录密码：在服务启动后，查看config/initial_root_password文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cat /data/gitlab/config/initial_root_password

Password: gTgBikdfbPhNSzcztYyGfXMauatWUP52HsZbZowmgow=
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>启动</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="部署gitlab-方式二"><a href="#部署gitlab-方式二" class="header-anchor">#</a> 部署Gitlab（方式二）</h2> <h3 id="创建项目"><a href="#创建项目" class="header-anchor">#</a> 创建项目</h3> <p>进入页面【k3s-项目/命名空间】点击创建项目</p> <p><img src="/assets/img/image17.491311d9.png" alt=""></p> <p>输入创建名称：公共组件 点击创建</p> <p><img src="/assets/img/image18.ffcd4938.png" alt=""></p> <h3 id="创建命名空间"><a href="#创建命名空间" class="header-anchor">#</a> 创建命名空间</h3> <p>点击创建命名空间</p> <p><img src="/assets/img/image19.466e1fed.png" alt=""></p> <p>输入名称：cicd 点击创建</p> <p><img src="/assets/img/image20.9e7121db.png" alt=""></p> <h3 id="创建工作负载"><a href="#创建工作负载" class="header-anchor">#</a> 创建工作负载</h3> <p>进入页面【k3s-工作负载-Deployments】点击创建</p> <h4 id="containers"><a href="#containers" class="header-anchor">#</a> Containers</h4> <p>镜像：gitlab/gitlab-ce:14.0.6-ce.0</p> <p>端口：集群IP 8929</p> <p>环境变量：</p> <table><thead><tr><th>变量名称</th> <th>变量值</th></tr></thead> <tbody><tr><td>GITLAB_OMNIBUS_CONFIG</td> <td>external_url 'http://192.168.213.201:8929'; gitlab_rails['gitlab_shell_ssh_port'] = 2222;</td></tr></tbody></table> <p><img src="/assets/img/image21.36e30037.png" alt=""></p> <p><img src="/assets/img/image22.6145281e.png" alt=""></p> <p><img src="/assets/img/image23.25ab4010.png" alt=""></p> <h4 id="存储挂载nfs"><a href="#存储挂载nfs" class="header-anchor">#</a> 存储挂载NFS</h4> <p>卷插件选择：NFS</p> <p>输入名称：nfs221</p> <p>服务端部署信息：/data/share 192.168.213.221</p> <table><thead><tr><th>挂载点</th> <th>卷内子路径</th></tr></thead> <tbody><tr><td>/etc/gitlab</td> <td>gitlab/config</td></tr> <tr><td>/var/log/gitlab</td> <td>gitlab/logs</td></tr> <tr><td>/var/opt/gitlab</td> <td>gitlab/data</td></tr></tbody></table> <p><img src="/assets/img/image24.5a255781.png" alt=""></p> <h4 id="点击创建完成启动"><a href="#点击创建完成启动" class="header-anchor">#</a> 点击创建完成启动</h4> <p><img src="/assets/img/image25.e08ec875.png" alt=""></p> <h4 id="服务发现"><a href="#服务发现" class="header-anchor">#</a> 服务发现</h4> <p>进入服务发现页面，编辑配置，修改配置 增加外网ip</p> <p><img src="/assets/img/image26.576884d0.png" alt=""></p> <p>输入：192.168.213.201</p> <p><img src="/assets/img/image27.f5e1db87.png" alt=""></p> <h4 id="浏览器访问"><a href="#浏览器访问" class="header-anchor">#</a> 浏览器访问</h4> <p><img src="/assets/img/image28.97ef809d.png" alt=""></p> <h4 id="登录密码-221"><a href="#登录密码-221" class="header-anchor">#</a> 登录密码（221）</h4> <p>因为密码是初始化后的文件内容，而部署时将文件挂载在NFS上，故
直接登录221服务器上即可查看GitLab初始化密码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>C8a4/zTtKRT0c64LSTLRxgpK1zQLEst2JbRhEfpFyWk=
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd /data/share
cat gitlab/config/initial_root_password
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/assets/img/image29.91b99fc7.png" alt=""></p> <h2 id="部署jenkins-222"><a href="#部署jenkins-222" class="header-anchor">#</a> 部署Jenkins（222）</h2> <h3 id="制作镜像"><a href="#制作镜像" class="header-anchor">#</a> 制作镜像</h3> <h4 id="构建镜像"><a href="#构建镜像" class="header-anchor">#</a> 构建镜像</h4> <p>由于原生镜像没有安装maven和git，故我们重新写一个Dockerfile生成镜像，编写Dockerfile文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir /data/jenkins
cd /data/jenkins &amp;&amp; vi Dockerfile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>输入以下内容</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>FROM jenkins/jenkins:2.377-centos7
USER root
RUN yum install -y maven
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="生成镜像"><a href="#生成镜像" class="header-anchor">#</a> 生成镜像</h4> <p>执行命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  docker build -t jenkins:2.377-centos7-mvn .
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="创建启动"><a href="#创建启动" class="header-anchor">#</a> 创建启动</h3> <p>编辑文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  cd /data/jenkins &amp;&amp; vi docker-compose.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输入内容</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3'
services:
  jenkins:
    image: 'jenkins:2.377-centos7-mvn'
    container_name: jenkins
    restart: always
    user: root
    ports:
      - '7080:8080'
      - '7050:50000'
    volumes:
      - './jenkins_home:/var/jenkins_home'
      - '/var/run/docker.sock:/var/run/docker.sock'
      - '/usr/bin/docker:/usr/bin/docker'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>启动</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  cd /data/jenkins &amp;&amp; docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="浏览器访问-2"><a href="#浏览器访问-2" class="header-anchor">#</a> 浏览器访问</h3> <p>访问地址：192.168.213.222:7080</p> <p><img src="/assets/img/image30.3b3578f6.png" alt=""></p> <h3 id="登录密码"><a href="#登录密码" class="header-anchor">#</a> 登录密码</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@middleware222 share]# cat /data/jenkins/jenkins_home/secrets/initialAdminPassword                                                                                                                                                            564de39cc45347589909febf57e73383
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h1 id="初始化配置"><a href="#初始化配置" class="header-anchor">#</a> 初始化配置</h1> <h2 id="初始化jenkins"><a href="#初始化jenkins" class="header-anchor">#</a> 初始化Jenkins</h2> <h3 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h3> <p>使用管理员账号登录后安装推荐的插件</p> <p><img src="/assets/img/image31.9019efe5.png" alt=""></p> <p><img src="/assets/img/image32.9804c74b.png" alt=""></p> <p>修改管理员信息：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>登录名：admin
账号：admin
密码：Admin123
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/assets/img/image33.5cd9c0f8.png" alt=""></p> <h3 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h3> <h4 id="查看java和maven安装地址"><a href="#查看java和maven安装地址" class="header-anchor">#</a> 查看java和maven安装地址</h4> <p>进入jenkins容器内执行</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@middleware222 ~]# docker exec -it jenkins /bin/sh
sh-4.2# mvn -version
Apache Maven 3.0.5 (Red Hat 3.0.5-17)
Maven home: /usr/share/maven
Java version: 11.0.16.1, vendor: Eclipse Adoptium
Java home: /opt/java/openjdk
Default locale: en_US, platform encoding: UTF-8
OS name: &quot;linux&quot;, version: &quot;3.10.0-1160.el7.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;
sh-4.2#
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="配置jdk"><a href="#配置jdk" class="header-anchor">#</a> 配置JDK</h4> <p>登录到Jenkins管理后台，点击 Manage Jenkins --&gt; Global Tool Configuration</p> <p><img src="/assets/img/image34.527b84c3.png" alt=""></p> <p>点击新增JDK</p> <p><img src="/assets/img/image35.1074705b.png" alt=""></p> <p>自动安装 前面的勾选，去掉，输入别名和JAVA_HOME</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>别名：jdk11
JAVA_HOME：/opt/java/openjdk
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/assets/img/image36.9c35a99b.png" alt=""></p> <p>点击应用</p> <h4 id="配置maven"><a href="#配置maven" class="header-anchor">#</a> 配置Maven</h4> <p>同JDK配置页面</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>取消自动安装，输入配置信息</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>别名：maven305
MAVEN_HOME：/usr/share/maven
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/assets/img/image38.654c93bd.png" alt=""></p> <p>点击保存</p> <h3 id="自定义安装插件"><a href="#自定义安装插件" class="header-anchor">#</a> 自定义安装插件</h3> <p>安装插件：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Docker Pipeline
GitLab
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/assets/img/image39.87740ced.png" alt=""></p> <h2 id="测试jenkins"><a href="#测试jenkins" class="header-anchor">#</a> 测试Jenkins</h2> <h3 id="测试-docker-maven"><a href="#测试-docker-maven" class="header-anchor">#</a> 测试(docker-maven)</h3> <h4 id="创建流水线任务"><a href="#创建流水线任务" class="header-anchor">#</a> 创建流水线任务</h4> <p><img src="/assets/img/image40.7a7aef62.png" alt=""></p> <h4 id="pipeline脚本"><a href="#pipeline脚本" class="header-anchor">#</a> pipeline脚本</h4> <p>输入内容，点击保存</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>pipeline {
    agent any
stages {
        stage('TestMaven') {
            steps {
                sh 'mvn -version'
            }
        }
        stage('TestDocker') {
            steps {
                sh 'docker images'
            }
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><img src="/assets/img/image41.2116996a.png" alt=""></p> <h4 id="构建触发器-关联gitlab"><a href="#构建触发器-关联gitlab" class="header-anchor">#</a> 构建触发器（关联Gitlab）</h4> <p>选择：触发远程构建 (例如,使用脚本)</p> <p>例如Token：imtest</p> <p>后续则可以使用接口地址触发构建</p> <p>JENKINS_URL/job/imtest1/build?token=imtest</p> <p><img src="/assets/img/image42.bdc5e637.png" alt=""></p> <h4 id="立即构建"><a href="#立即构建" class="header-anchor">#</a> 立即构建</h4> <p>查看控制台</p> <p><img src="/assets/img/image43.8fe9b529.png" alt=""></p> <h2 id="初始化harbor"><a href="#初始化harbor" class="header-anchor">#</a> 初始化Harbor</h2> <p>登录Harbor</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>地址：http://192.168.213.222:22280/
账号：admin
密码：Harbor12345
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>创建公开项目：imdemo</p> <p><img src="/assets/img/image44.0cbfa64c.png" alt=""></p> <p>创建公开项目：cicd</p> <p><img src="/assets/img/image45.c4644961.png" alt=""></p> <h2 id="初始化gitlab"><a href="#初始化gitlab" class="header-anchor">#</a> 初始化Gitlab</h2> <h3 id="登录"><a href="#登录" class="header-anchor">#</a> 登录</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>地址：192.168.213.222:8929
账号：root
登录密码：在服务启动后，查看config/initial_root_password文件
cat /data/gitlab/config/initial_root_password
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="创建用户"><a href="#创建用户" class="header-anchor">#</a> 创建用户</h3> <p>用户信息，例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>账号：jenkins
密码：Jenkins123
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="创建用户-2"><a href="#创建用户-2" class="header-anchor">#</a> 创建用户</h4> <p><img src="/assets/img/image46.a7923760.png" alt=""></p> <p><img src="/assets/img/image47.f308bc39.png" alt=""></p> <h4 id="初始化密码"><a href="#初始化密码" class="header-anchor">#</a> 初始化密码</h4> <p>在创建完成账号时，密码是不可填写的，在编辑中，初始化一下密码</p> <p><img src="/assets/img/image48.c0ae23b0.png" alt=""></p> <p>登录先重置一下密码，然后保存登录到首页</p> <p><img src="/assets/img/image49.d1cab7ae.png" alt=""></p> <h3 id="初始化项目-root权限"><a href="#初始化项目-root权限" class="header-anchor">#</a> 初始化项目(root权限)</h3> <h4 id="创建组"><a href="#创建组" class="header-anchor">#</a> 创建组</h4> <p>创建组名：ar3d</p> <p><img src="/assets/img/image50.85474edb.png" alt=""></p> <h4 id="创建空项目"><a href="#创建空项目" class="header-anchor">#</a> 创建空项目</h4> <p>项目名称：ok-springboot-imdemo</p> <p><img src="/assets/img/image51.3f8962c9.png" alt=""></p> <h4 id="创建dev分支"><a href="#创建dev分支" class="header-anchor">#</a> 创建dev分支</h4> <p><img src="/assets/img/image52.bca00a7f.png" alt=""></p> <p><img src="/assets/img/image53.3b6c7613.png" alt=""></p> <h4 id="提交项目代码"><a href="#提交项目代码" class="header-anchor">#</a> 提交项目代码</h4> <p>附件：ok-springboot-imdemo-dev.zip 上传至dev</p> <h4 id="赋权账号"><a href="#赋权账号" class="header-anchor">#</a> 赋权账号</h4> <p>Members：</p> <p><img src="/assets/img/image54.0173c62c.png" alt=""></p> <h1 id="gitlab-jenkins配置"><a href="#gitlab-jenkins配置" class="header-anchor">#</a> GitLab+Jenkins配置</h1> <h2 id="设置jenkins-用户ssh秘钥"><a href="#设置jenkins-用户ssh秘钥" class="header-anchor">#</a> 设置jenkins 用户ssh秘钥</h2> <p>登录到jenkins服务器（222），生成秘钥</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ssh-keygen -t rsa -P &quot;&quot; -f ~/.ssh/id_rsa
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看公钥</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cat /root/.ssh/id_rsa.pub
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>登录GitLab使用Jenkins用户</p> <p>点击 ssh keys，将公钥内容复制到网页，点击添加秘钥</p> <p><img src="/assets/img/image55.fcedc93f.png" alt=""></p> <h2 id="获取access-tokens"><a href="#获取access-tokens" class="header-anchor">#</a> 获取Access Tokens</h2> <p>登录jenkins帐号，获取Access Tokens</p> <p><img src="/assets/img/image56.39fca979.png" alt=""></p> <p>点击后返回：glpat-39WoU5Bou4bn6-sqvgPb</p> <h2 id="jenkins配置git-gitlab"><a href="#jenkins配置git-gitlab" class="header-anchor">#</a> Jenkins配置Git/GitLab</h2> <h3 id="jenkins配置gitlab"><a href="#jenkins配置gitlab" class="header-anchor">#</a> Jenkins配置GitLab</h3> <p>点击 系统管理--&gt; 系统配置 --&gt;配置 --&gt;Gitlab</p> <p><img src="/assets/img/image57.e9ec4529.png" alt=""></p> <p>Connection Name &quot;随便填，&quot;Git Host
URL&quot;填GitLab的访问地址，然后点&quot;Add&quot;------&quot;jenkins&quot;，如下所示</p> <p><img src="/assets/img/image58.a5c6bfad.png" alt=""></p> <p>选择gitlalb api，输入 jenkins 用户创建的token</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  glpat-39WoU5Bou4bn6-sqvgPb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image59.e9da9abf.png" alt=""></p> <p>选择 gitlab api token，点击测试连接，出现 Success，表示成功</p> <p><img src="/assets/img/image60.a8e9908c.png" alt=""></p> <h3 id="jenkins配置git"><a href="#jenkins配置git" class="header-anchor">#</a> Jenkins配置Git</h3> <p>点击 Manage Jenkins --&gt; Configure System --&gt;配置 --&gt;Git plugin</p> <p><img src="/assets/img/image61.15c9b9b3.png" alt=""></p> <p>设置Git插件的全局配置，然后点击最下面的保存。</p> <p><img src="/assets/img/image62.fc8d052e.png" alt=""></p> <h2 id="创建jenkins-job-gitlab"><a href="#创建jenkins-job-gitlab" class="header-anchor">#</a> 创建Jenkins-job(gitlab)</h2> <h3 id="新建item-ok-springboot-imdemo"><a href="#新建item-ok-springboot-imdemo" class="header-anchor">#</a> 新建Item：ok-springboot-imdemo</h3> <p>点击&quot;流水线&quot;，点击Ok</p> <p><img src="/assets/img/image63.d18fc920.png" alt=""></p> <h3 id="配置-2"><a href="#配置-2" class="header-anchor">#</a> 配置</h3> <h4 id="流水线"><a href="#流水线" class="header-anchor">#</a> 流水线</h4> <p>选择&quot;SCM&quot;，选择&quot;Git&quot;,然后去GitLab中复制项目地址，粘贴到&quot;Repository
URL&quot;,然后点击&quot;credentials&quot;后面的添加按钮</p> <p><img src="/assets/img/image64.e624ac40.png" alt=""></p> <p>类型，选择 Username with password</p> <p>用户名 填 jenkins</p> <p>密码 填 Jenkins123</p> <p><img src="/assets/img/image65.9f18c17d.png" alt=""></p> <p>添加后选择</p> <p><img src="/assets/img/image66.c90b9749.png" alt=""></p> <h4 id="构建触发器"><a href="#构建触发器" class="header-anchor">#</a> 构建触发器</h4> <p>填写job名称：ok-springboot-imdemo</p> <p>则Url：</p> <p>http://192.168.213.222:7080/job/ok-springboot-imdemo/build?token=ok-springboot-imdemo</p> <p><img src="/assets/img/image67.0577638e.png" alt=""></p> <p>保存应用</p> <h1 id="rancher-jenkins-harbor-gitlab"><a href="#rancher-jenkins-harbor-gitlab" class="header-anchor">#</a> Rancher+Jenkins+Harbor+GitLab</h1> <h2 id="rancher创建密文-harbor-k3s"><a href="#rancher创建密文-harbor-k3s" class="header-anchor">#</a> Rancher创建密文-Harbor（K3S）</h2> <p>进入页面【存储-密文】点击创建，选择镜像仓库</p> <p><img src="/assets/img/image68.77c02f0e.png" alt=""></p> <p>输入Harbor信息</p> <p><img src="/assets/img/image69.e5c8ee88.png" alt=""></p> <h2 id="rancher更新镜像构建"><a href="#rancher更新镜像构建" class="header-anchor">#</a> Rancher更新镜像构建</h2> <h3 id="下载cli"><a href="#下载cli" class="header-anchor">#</a> 下载CLI</h3> <p>下载地址，点击版本号</p> <p><img src="/assets/img/image70.cfe6fb17.png" alt=""></p> <p>点击Linux版本下载</p> <p><img src="/assets/img/image71.2c736a5e.png" alt=""></p> <h3 id="下载kubectl"><a href="#下载kubectl" class="header-anchor">#</a> 下载kubectl</h3> <p>获取版本</p> <p>https://dl.k8s.io/release/stable.txt</p> <p>返回版本号：v1.25.4</p> <p>下载地址则为：</p> <p>https://dl.k8s.io/release/v1.25.4/bin/linux/amd64/kubectl</p> <h3 id="构建镜像并上传"><a href="#构建镜像并上传" class="header-anchor">#</a> 构建镜像并上传</h3> <p>上传cli及kubectl至222服务器，创建及上传目录：/data/rancher/docker</p> <p>编写Dockerfile</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  cd /data/rancher/docker &amp;&amp; vi Dockerfile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输入文件内容，保存退出</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>FROM alpine:3.16.3

copy ./rancher-linux-amd64-v2.6.9.tar.gz /usr/bin/rancher-linux-amd64-v2.6.9.tar.gz
copy ./kubectl /usr/bin/kubectl

RUN cd /usr/bin/ \
    &amp;&amp; tar zxvf rancher-linux-amd64-v2.6.9.tar.gz \
    &amp;&amp; mv rancher-v2.6.9/rancher . \
    &amp;&amp; rm rancher-linux-amd64-v2.6.9.tar.gz \
    &amp;&amp; rm -r rancher-v2.6.9 \
    &amp;&amp; chmod u+x kubectl
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>构建镜像并上传至harbor</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker build -t 192.168.213.222:22280/cicd/rancher-cli:1.0.0 .
docker push 192.168.213.222:22280/cicd/rancher-cli:1.0.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="jenkins构建微服务镜像"><a href="#jenkins构建微服务镜像" class="header-anchor">#</a> Jenkins构建微服务镜像</h2> <p>进入ok-springboot-imdemo，点击立即构建</p> <p><img src="/assets/img/image72.ec1be03f.png" alt=""></p> <p>立即构建-查看日志，第一次会报错。</p> <p><img src="/assets/img/image73.3ee4c14d.png" alt=""></p> <p>复制镜像地址：192.168.213.222:22280/imdemo/ok-springboot-imdemo:3</p> <p><img src="/assets/img/image74.db7071e4.png" alt=""></p> <h2 id="rancher创建微服务"><a href="#rancher创建微服务" class="header-anchor">#</a> Rancher创建微服务</h2> <h3 id="创建项目-2"><a href="#创建项目-2" class="header-anchor">#</a> 创建项目</h3> <p>进入页面：</p> <p><img src="/assets/img/image75.dd835cc9.png" alt=""></p> <p>创建项目：demo</p> <p><img src="/assets/img/image76.3ab6aae6.png" alt=""></p> <h3 id="创建命名空间-2"><a href="#创建命名空间-2" class="header-anchor">#</a> 创建命名空间</h3> <p>进入页面</p> <p><img src="/assets/img/image77.5c61c4a3.png" alt=""></p> <p>创建项目：ok</p> <p><img src="/assets/img/image78.7dc324e6.png" alt=""></p> <h3 id="创建负载"><a href="#创建负载" class="header-anchor">#</a> 创建负载</h3> <p>进入页面：</p> <p><img src="/assets/img/image79.422c3973.png" alt=""></p> <p>命名空间选择：ok</p> <p>名称：ok-springboot-imdemo</p> <p>镜像：192.168.213.222:22280/imdemo/ok-springboot-imdemo:3</p> <p>端口：8610 监听30010</p> <p><img src="/assets/img/image80.01000ccf.png" alt=""></p> <p>完成创建后页面访问：</p> <p>http://192.168.213.201:30010/ok-springboot-imdemo/hello</p> <p><img src="data:image/png;base64,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" alt=""></p> <h2 id="gitlab触发jenkins"><a href="#gitlab触发jenkins" class="header-anchor">#</a> Gitlab触发Jenkins</h2> <h3 id="gitlab取消限制策略"><a href="#gitlab取消限制策略" class="header-anchor">#</a> Gitlab取消限制策略</h3> <p>禁止向本地连接发送请求</p> <p>由于Gitlab和Jenkins安装在同台服务器，且Gitlab 10.6
版本以后为了安全，默认不允许向本地网络发送webhook请求。先将禁止取消。</p> <p>点击勾选[Allow requests to the local network from web hooks and services]，并保存</p> <p><img src="/assets/img/image82.01081a4c.png" alt=""></p> <h3 id="jenkins取消限制策略"><a href="#jenkins取消限制策略" class="header-anchor">#</a> Jenkins取消限制策略</h3> <p>由于Gitlab和Jenkins安装在同台服务器</p> <p>勾选[匿名用户具有可读权限]</p> <p><img src="/assets/img/image83.446bbe52.png" alt=""></p> <p>修改222服务器jenkins docker-compose.yml文件</p> <p>增加文件内容</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    environment: 
      - JAVA_OPTS=-Dhudson.security.csrf.GlobalCrumbIssuerConfiguration.DISABLE_CSRF_PROTECTION=true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="data:image/png;base64,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" alt=""></p> <h3 id="配置触发"><a href="#配置触发" class="header-anchor">#</a> 配置触发</h3> <p>进入Gitlab页面：</p> <p>打开代码仓库，进入回调配置页面。需要仓库维护者权限才能看到此菜单。</p> <p><img src="/assets/img/image85.19177cfb.png" alt=""></p> <p>Url从本文档的jenkins任务配置中获取：</p> <p>http://192.168.213.222:7080/job/ok-springboot-imdemo/build?token=ok-springboot-imdemo</p> <p><img src="/assets/img/image86.169e3970.png" alt=""></p> <p>点击增加</p> <p><img src="/assets/img/image87.67763a4a.png" alt=""></p> <p>完成提交代码自动构建</p> <h2 id="触发rancher更新镜像"><a href="#触发rancher更新镜像" class="header-anchor">#</a> 触发Rancher更新镜像</h2> <h3 id="创建api密钥"><a href="#创建api密钥" class="header-anchor">#</a> 创建API密钥</h3> <p>进入页面：</p> <p><img src="/assets/img/image88.d03c1c75.png" alt=""></p> <p>输入描述并创建</p> <p><img src="/assets/img/image89.4ad6e489.png" alt=""></p> <h3 id="复制持有者令牌"><a href="#复制持有者令牌" class="header-anchor">#</a> 复制持有者令牌</h3> <p><img src="/assets/img/image90.2c79d764.png" alt=""></p> <p>令牌：token-hcht8:wq4s7cwnxj64s5492rtcnz7hsp27dmzl8qxmwgz9v5kl56lqftr4bj</p> <h3 id="复制api地址"><a href="#复制api地址" class="header-anchor">#</a> 复制API地址</h3> <p><img src="/assets/img/image91.1f2549a2.png" alt=""></p> <p>地址：https://rancher.ok96.cn:8443/v3</p> <p>更新命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run --rm --name ranchercli 192.168.213.222:22280/cicd/rancher-cli:1.0.0  sh -c  &quot;rancher login https://rancher.ok96.cn:8443/v3 --token token-hcht8:wq4s7cwnxj64s5492rtcnz7hsp27dmzl8qxmwgz9v5kl56lqftr4bj&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="复制项目project-id"><a href="#复制项目project-id" class="header-anchor">#</a> 复制项目PROJECT ID</h3> <p>进入页面，查看yaml：</p> <p><img src="/assets/img/image92.891bf24a.png" alt=""></p> <p>找到name及namespace：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>name: p-4ltfh
namespace: c-m-hwhwchxr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>即PROJECT ID： c-m-hwhwchxr:p-4ltfh</p> <p><img src="/assets/img/image93.a542ef59.png" alt=""></p> <h3 id="复制项目containername"><a href="#复制项目containername" class="header-anchor">#</a> 复制项目ContainerName</h3> <p>进入页面：</p> <p><img src="/assets/img/image94.73ea1706.png" alt=""></p> <p>复制容器名称：container-0</p> <p><img src="/assets/img/image95.8f7ac794.png" alt=""></p> <h3 id="更新镜像命令说明"><a href="#更新镜像命令说明" class="header-anchor">#</a> 更新镜像命令说明</h3> <p>命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>rancher login ${Rancher.URL} --token ${rancher} --context ${RancherProjectId}
rancher kubectl set image deployment.apps/${projectConfig.projectName} ${containerName}=${IMAGE_FULL_PATH} -n ${K8S_NAMESPACE}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>其中：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>${Rancher.URL}：为api地址【https://rancher.ok96.cn:8443/v3】
${rancher}：为token【token-hcht8:wq4s7cwnxj64s5492rtcnz7hsp27dmzl8qxmwgz9v5kl56lqftr4bj】
${RancherProjectId}：为ProjectId【c-m-hwhwchxr:p-4ltfh】
${projectConfig.projectName}：为项目名称【ok-springboot-imdemo】
${containerName}：为容器名称【container-0】
${K8S_NAMESPACE}：为命名空间名称【ok】
${IMAGE_FULL_PATH}：为更新容器镜像的地址
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="更新镜像容器命令示例"><a href="#更新镜像容器命令示例" class="header-anchor">#</a> 更新镜像容器命令示例</h3> <p>示例：更新容器镜像为【192.168.213.222:22280/imdemo/ok-springboot-imdemo:7】</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run --rm --name ranchercli 192.168.213.222:22280/cicd/rancher-cli:1.0.0  sh -c  &quot;rancher login https://rancher.ok96.cn:8443/v3 --token token-hcht8:wq4s7cwnxj64s5492rtcnz7hsp27dmzl8qxmwgz9v5kl56lqftr4bj --context c-m-hwhwchxr:p-4ltfh &amp;&amp; rancher kubectl set image deployment.apps/ok-springboot-imdemo container-0=192.168.213.222:22280/imdemo/ok-springboot-imdemo:7 -n ok&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h1 id="附件"><a href="#附件" class="header-anchor">#</a> 附件</h1> <p>百度云下载：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>链接：https://pan.baidu.com/s/1IXSRk4wSI_-ppAhn1PaFPg 
提取码：izt1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>说明</p> <table><thead><tr><th>文件名称</th> <th>说明</th> <th>备注</th></tr></thead> <tbody><tr><td>harbor-offline-installer-v2.2.3.tgz</td> <td>harbor安装包</td> <td>https://github.com/goharbor/harbor/releases/</td></tr> <tr><td>BinaryInstallation.zip</td> <td>Docker二进制安装包</td> <td>-</td></tr> <tr><td>ok-springboot-imdemo-dev.zip</td> <td>微服务工程示例代码</td> <td>-</td></tr></tbody></table></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/03/14, 05:37:24</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/04f4f5/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">K3S-在线安装</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/04f4f5/" class="prev">K3S-在线安装</a></span> <!----></p></div></div></div> <!----></main></div> <div class="footer">
     Copyright © 2019-2024
    <span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f4baf4ac.js" defer></script><script src="/assets/js/4.fb059a0d.js" defer></script><script src="/assets/js/6.0568657e.js" defer></script><script src="/assets/js/2.24e37fe1.js" defer></script>
  </body>
</html>
